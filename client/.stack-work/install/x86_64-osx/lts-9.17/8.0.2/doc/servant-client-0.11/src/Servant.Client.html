<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                  #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DataKinds            #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts     #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances    #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE InstanceSigs         #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings    #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE PolyKinds            #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables  #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies         #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators        #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-cpp">#include &quot;overlapping-compat.h&quot;</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- | This module provides 'client' which can automatically generate</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- querying functions for each endpoint just from the type representing your</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- API.</span><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Servant</span><span class="hs-operator">.</span><span class="hs-identifier">Client</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Servant.Client.Experimental.Auth.html#AuthClientData"><span class="hs-identifier hs-type">AuthClientData</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Client.Experimental.Auth.html#AuthenticateReq"><span class="hs-identifier hs-type">AuthenticateReq</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Client.html#client"><span class="hs-identifier hs-var">client</span></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Common.Req.html#ClientM"><span class="hs-identifier hs-type">ClientM</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Common.Req.html#runClientM"><span class="hs-identifier hs-var">runClientM</span></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Common.Req.html#ClientEnv"><span class="hs-identifier hs-type">ClientEnv</span></a><span> </span><span class="hs-special">(</span><a href="Servant.Common.Req.html#ClientEnv"><span class="hs-identifier hs-var">ClientEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Client.Experimental.Auth.html#mkAuthenticateReq"><span class="hs-identifier hs-var">mkAuthenticateReq</span></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Common.Req.html#ServantError"><span class="hs-identifier hs-type">ServantError</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Servant.Client.html#EmptyClient"><span class="hs-identifier hs-type">EmptyClient</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Servant</span><span class="hs-operator">.</span><span class="hs-identifier">Common</span><span class="hs-operator">.</span><span class="hs-identifier">BaseUrl</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Proxy</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">String</span><span class="hs-operator">.</span><span class="hs-identifier">Conversions</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unpack</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">TypeLits</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Client</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Response</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Media</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">H</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">Header</span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">HTTP</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Prelude</span><span class="hs-operator">.</span><span class="hs-identifier">Compat</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Servant</span><span class="hs-operator">.</span><span class="hs-identifier">API</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><a href="Servant.Client.Experimental.Auth.html"><span class="hs-identifier">Servant</span><span class="hs-operator">.</span><span class="hs-identifier">Client</span><span class="hs-operator">.</span><span class="hs-identifier">Experimental</span><span class="hs-operator">.</span><span class="hs-identifier">Auth</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><a href="Servant.Common.BaseUrl.html"><span class="hs-identifier">Servant</span><span class="hs-operator">.</span><span class="hs-identifier">Common</span><span class="hs-operator">.</span><span class="hs-identifier">BaseUrl</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><a href="Servant.Common.BasicAuth.html"><span class="hs-identifier">Servant</span><span class="hs-operator">.</span><span class="hs-identifier">Common</span><span class="hs-operator">.</span><span class="hs-identifier">BasicAuth</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><a href="Servant.Common.Req.html"><span class="hs-identifier">Servant</span><span class="hs-operator">.</span><span class="hs-identifier">Common</span><span class="hs-operator">.</span><span class="hs-identifier">Req</span></a><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- * Accessing APIs as a Client</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- | 'client' allows you to produce operations to query an API from a client.</span><span>
</span><a name="line-52"></a><span class="hs-comment">--</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- &gt; type MyApi = &quot;books&quot; :&gt; Get '[JSON] [Book] -- GET /books</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- &gt;         :&lt;|&gt; &quot;books&quot; :&gt; ReqBody '[JSON] Book :&gt; Post '[JSON] Book -- POST /books</span><span>
</span><a name="line-55"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-56"></a><span class="hs-comment">-- &gt; myApi :: Proxy MyApi</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- &gt; myApi = Proxy</span><span>
</span><a name="line-58"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-59"></a><span class="hs-comment">-- &gt; getAllBooks :: ClientM [Book]</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- &gt; postNewBook :: Book -&gt; ClientM Book</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- &gt; (getAllBooks :&lt;|&gt; postNewBook) = client myApi</span><span>
</span><a name="line-62"></a><span class="hs-identifier">client</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><a href="#local-6989586621679114938"><span class="hs-identifier hs-type">api</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679114938"><span class="hs-identifier hs-type">api</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Servant.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a><span> </span><a href="#local-6989586621679114938"><span class="hs-identifier hs-type">api</span></a><span>
</span><a name="line-63"></a><a name="client"><a href="Servant.Client.html#client"><span class="hs-identifier">client</span></a></a><span> </span><a name="local-6989586621679114939"><a href="#local-6989586621679114939"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier hs-var">clientWithRoute</span></a><span> </span><a href="#local-6989586621679114939"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Servant.Common.Req.html#defReq"><span class="hs-identifier hs-var">defReq</span></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | This class lets us define how each API combinator</span><span>
</span><a name="line-66"></a><span class="hs-comment">-- influences the creation of an HTTP request. It's mostly</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- an internal class, you can just use 'client'.</span><span>
</span><a name="line-68"></a><span class="hs-keyword">class</span><span> </span><a name="HasClient"><a href="Servant.Client.html#HasClient"><span class="hs-identifier">HasClient</span></a></a><span> </span><a name="local-6989586621679114937"><a href="#local-6989586621679114937"><span class="hs-identifier">api</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-69"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Client</span><span> </span><a name="local-6989586621679114937"><a href="#local-6989586621679114937"><span class="hs-identifier">api</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator hs-type">*</span><span>
</span><a name="line-70"></a><span>  </span><span class="hs-identifier">clientWithRoute</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679114937"><span class="hs-identifier hs-type">api</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Servant.Common.Req.html#Req"><span class="hs-identifier hs-type">Req</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Servant.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a><span> </span><a href="#local-6989586621679114937"><span class="hs-identifier hs-type">api</span></a><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | A client querying function for @a ':&lt;|&gt;' b@ will actually hand you</span><span>
</span><a name="line-74"></a><span class="hs-comment">--   one function for querying @a@ and another one for querying @b@,</span><span>
</span><a name="line-75"></a><span class="hs-comment">--   stitching them together with ':&lt;|&gt;', which really is just like a pair.</span><span>
</span><a name="line-76"></a><span class="hs-comment">--</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- &gt; type MyApi = &quot;books&quot; :&gt; Get '[JSON] [Book] -- GET /books</span><span>
</span><a name="line-78"></a><span class="hs-comment">-- &gt;         :&lt;|&gt; &quot;books&quot; :&gt; ReqBody '[JSON] Book :&gt; Post Book -- POST /books</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- &gt; myApi :: Proxy MyApi</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- &gt; myApi = Proxy</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- &gt; getAllBooks :: ClientM [Book]</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- &gt; postNewBook :: Book -&gt; ClientM Book</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- &gt; (getAllBooks :&lt;|&gt; postNewBook) = client myApi</span><span>
</span><a name="line-86"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><a href="#local-6989586621679115293"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><a href="#local-6989586621679115294"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679115293"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679115294"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Client</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679115293"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679115294"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Servant.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a><span> </span><a href="#local-6989586621679115293"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><a href="Servant.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a><span> </span><a href="#local-6989586621679115294"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-88"></a><span>  </span><a name="local-8214565720323889432"><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier">clientWithRoute</span></a></a><span> </span><span class="hs-identifier hs-var">Proxy</span><span> </span><a name="local-6989586621679115411"><a href="#local-6989586621679115411"><span class="hs-identifier">req</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-89"></a><span>    </span><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier hs-var">clientWithRoute</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679115293"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679115411"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span>
</span><a name="line-90"></a><span>    </span><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier hs-var">clientWithRoute</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679115294"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679115411"><span class="hs-identifier hs-var">req</span></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- | Singleton type representing a client for an empty API.</span><span>
</span><a name="line-93"></a><span class="hs-keyword">data</span><span> </span><a name="EmptyClient"><a href="Servant.Client.html#EmptyClient"><span class="hs-identifier">EmptyClient</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EmptyClient"><a href="Servant.Client.html#EmptyClient"><span class="hs-identifier">EmptyClient</span></a></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | The client for 'EmptyAPI' is simply 'EmptyClient'.</span><span>
</span><a name="line-96"></a><span class="hs-comment">--</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- &gt; type MyAPI = &quot;books&quot; :&gt; Get '[JSON] [Book] -- GET /books</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- &gt;         :&lt;|&gt; &quot;nothing&quot; :&gt; EmptyAPI</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- &gt; myApi :: Proxy MyApi</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- &gt; myApi = Proxy</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- &gt; getAllBooks :: ClientM [Book]</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- &gt; (getAllBooks :&lt;|&gt; EmptyClient) = client myApi</span><span>
</span><a name="line-105"></a><span class="hs-keyword">instance</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><span class="hs-identifier hs-type">EmptyAPI</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-106"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Client</span><span> </span><span class="hs-identifier hs-type">EmptyAPI</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Servant.Client.html#EmptyClient"><span class="hs-identifier hs-type">EmptyClient</span></a><span>
</span><a name="line-107"></a><span>  </span><a name="local-8214565720323889432"><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier">clientWithRoute</span></a></a><span> </span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Servant.Client.html#EmptyClient"><span class="hs-identifier hs-var">EmptyClient</span></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-- | If you use a 'Capture' in one of your endpoints in your API,</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- the corresponding querying function will automatically take</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- an additional argument of the type specified by your 'Capture'.</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- That function will take care of inserting a textual representation</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- of this value at the right place in the request path.</span><span>
</span><a name="line-114"></a><span class="hs-comment">--</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- You can control how values for this type are turned into</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- text by specifying a 'ToHttpApiData' instance for your type.</span><span>
</span><a name="line-117"></a><span class="hs-comment">--</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- Example:</span><span>
</span><a name="line-119"></a><span class="hs-comment">--</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- &gt; type MyApi = &quot;books&quot; :&gt; Capture &quot;isbn&quot; Text :&gt; Get '[JSON] Book</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- &gt; myApi :: Proxy MyApi</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- &gt; myApi = Proxy</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- &gt; getBook :: Text -&gt; ClientM Book</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- &gt; getBook = client myApi</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- &gt; -- then you can just use &quot;getBook&quot; to query that endpoint</span><span>
</span><a name="line-128"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-6989586621679115209"><span class="hs-identifier hs-type">capture</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToHttpApiData</span><span> </span><a href="#local-6989586621679115210"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><a href="#local-6989586621679115211"><span class="hs-identifier hs-type">api</span></a><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Capture</span><span> </span><a href="#local-6989586621679115209"><span class="hs-identifier hs-type">capture</span></a><span> </span><a href="#local-6989586621679115210"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:&gt;</span><span> </span><a href="#local-6989586621679115211"><span class="hs-identifier hs-type">api</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Client</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Capture</span><span> </span><a href="#local-6989586621679115209"><span class="hs-identifier hs-type">capture</span></a><span> </span><a href="#local-6989586621679115210"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:&gt;</span><span> </span><a href="#local-6989586621679115211"><span class="hs-identifier hs-type">api</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-132"></a><span>    </span><a href="#local-6989586621679115210"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Servant.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a><span> </span><a href="#local-6989586621679115211"><span class="hs-identifier hs-type">api</span></a><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span>  </span><a name="local-8214565720323889432"><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier">clientWithRoute</span></a></a><span> </span><span class="hs-identifier hs-var">Proxy</span><span> </span><a name="local-6989586621679115212"><a href="#local-6989586621679115212"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-6989586621679115213"><a href="#local-6989586621679115213"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-135"></a><span>    </span><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier hs-var">clientWithRoute</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679115211"><span class="hs-identifier hs-type">api</span></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>                    </span><span class="hs-special">(</span><a href="Servant.Common.Req.html#appendToPath"><span class="hs-identifier hs-var">appendToPath</span></a><span> </span><a href="#local-6989586621679115214"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679115212"><span class="hs-identifier hs-var">req</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679115214"><a href="#local-6989586621679115214"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unpack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toUrlPiece</span><span> </span><a href="#local-6989586621679115213"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- | If you use a 'CaptureAll' in one of your endpoints in your API,</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- the corresponding querying function will automatically take an</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- additional argument of a list of the type specified by your</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- 'CaptureAll'. That function will take care of inserting a textual</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- representation of this value at the right place in the request</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- path.</span><span>
</span><a name="line-146"></a><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- You can control how these values are turned into text by specifying</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- a 'ToHttpApiData' instance of your type.</span><span>
</span><a name="line-149"></a><span class="hs-comment">--</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- Example:</span><span>
</span><a name="line-151"></a><span class="hs-comment">--</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- &gt; type MyAPI = &quot;src&quot; :&gt; CaptureAll Text -&gt; Get '[JSON] SourceFile</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- &gt; myApi :: Proxy</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- &gt; myApi = Proxy</span><span>
</span><a name="line-156"></a><span class="hs-comment">--</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- &gt; getSourceFile :: [Text] -&gt; ClientM SourceFile</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- &gt; getSourceFile = client myApi</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- &gt; -- then you can use &quot;getSourceFile&quot; to query that endpoint</span><span>
</span><a name="line-160"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-6989586621679115203"><span class="hs-identifier hs-type">capture</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToHttpApiData</span><span> </span><a href="#local-6989586621679115204"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><a href="#local-6989586621679115205"><span class="hs-identifier hs-type">sublayout</span></a><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Servant.Client.html#HasClient"><span class="hs-identifier hs-type">HasClient</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CaptureAll</span><span> </span><a href="#local-6989586621679115203"><span class="hs-identifier hs-type">capture</span></a><span> </span><a href="#local-6989586621679115204"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:&gt;</span><span> </span><a href="#local-6989586621679115205"><span class="hs-identifier hs-type">sublayout</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Client</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CaptureAll</span><span> </span><a href="#local-6989586621679115203"><span class="hs-identifier hs-type">capture</span></a><span> </span><a href="#local-6989586621679115204"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:&gt;</span><span> </span><a href="#local-6989586621679115205"><span class="hs-identifier hs-type">sublayout</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-special">[</span><a href="#local-6989586621679115204"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Servant.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a><span> </span><a href="#local-6989586621679115205"><span class="hs-identifier hs-type">sublayout</span></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span>  </span><a name="local-8214565720323889432"><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier">clientWithRoute</span></a></a><span> </span><span class="hs-identifier hs-var">Proxy</span><span> </span><a name="local-6989586621679115206"><a href="#local-6989586621679115206"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-6989586621679115207"><a href="#local-6989586621679115207"><span class="hs-identifier">vals</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-167"></a><span>    </span><a href="Servant.Client.html#clientWithRoute"><span class="hs-identifier hs-var">clientWithRoute</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679115205"><span class="hs-identifier hs-type">sublayout</span></a><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><a href="Servant.Common.Req.html#appendToPath"><span class="hs-identifier hs-var">appendToPath</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679115206"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-6989586621679115208"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679115208"><a href="#local-6989586621679115208"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unpack</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toUrlPiece</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679115207"><span class="hs-identifier hs-var">vals</span></a><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">OVERLAPPABLE_</span><span>
</span><a name="line-173"></a><span>  </span><span class="hs-comment">-- Note [Non-Empty Content Types]</span><span>
</span><a name="line-174"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MimeUnrender</span><span> </span><a href="#local-6989586621679115195"><span class="hs-identifier hs-type">ct</span></a><span> </span><a href="#local-6989586621679115196"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ReflectMethod</span><span> </span><a href="#local-6989586621679115197"><span class="hs-identifier hs-type">method</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115198"><span class="hs-identifier hs-type">cts'</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679115195"><span class="hs-identifier hs-type">ct</span></a><span> </span><span class="hs-char">': cts)
  ) =&gt; HasClient (Verb method status cts' a) where
  type Client (Verb method status cts' a) = ClientM a
  clientWithRoute Proxy req = do
    snd &lt;$&gt; performRequestCT (Proxy :: Proxy ct) method req
      where method = reflectMethod (Proxy :: Proxy method)

instance OVERLAPPING_
  (ReflectMethod method) =&gt; HasClient (Verb method status cts NoContent) where
  type Client (Verb method status cts NoContent)
    = ClientM NoContent
  clientWithRoute Proxy req = do
    performRequestNoBody method req &gt;&gt; return NoContent
      where method = reflectMethod (Proxy :: Proxy method)

instance OVERLAPPING_
  -- Note [Non-Empty Content Types]
  ( MimeUnrender ct a, BuildHeadersTo ls, ReflectMethod method, cts' ~ (ct ': cts)
  ) =&gt; HasClient (Verb method status cts' (Headers ls a)) where
  type Client (Verb method status cts' (Headers ls a))
    = ClientM (Headers ls a)
  clientWithRoute Proxy req = do
    let method = reflectMethod (Proxy :: Proxy method)
    (hdrs, resp) &lt;- performRequestCT (Proxy :: Proxy ct) method req
    return $ Headers { getResponse = resp
                     , getHeadersHList = buildHeadersTo hdrs
                     }

instance OVERLAPPING_
  ( BuildHeadersTo ls, ReflectMethod method
  ) =&gt; HasClient (Verb method status cts (Headers ls NoContent)) where
  type Client (Verb method status cts (Headers ls NoContent))
    = ClientM (Headers ls NoContent)
  clientWithRoute Proxy req = do
    let method = reflectMethod (Proxy :: Proxy method)
    hdrs &lt;- performRequestNoBody method req
    return $ Headers { getResponse = NoContent
                     , getHeadersHList = buildHeadersTo hdrs
                     }


-- | If you use a 'Header' in one of your endpoints in your API,
-- the corresponding querying function will automatically take
-- an additional argument of the type specified by your 'Header',
-- wrapped in Maybe.
--
-- That function will take care of encoding this argument as Text
-- in the request headers.
--
-- All you need is for your type to have a 'ToHttpApiData' instance.
--
-- Example:
--
-- &gt; newtype Referer = Referer { referrer :: Text }
-- &gt;   deriving (Eq, Show, Generic, ToHttpApiData)
-- &gt;
-- &gt;            -- GET /view-my-referer
-- &gt; type MyApi = &quot;view-my-referer&quot; :&gt; Header &quot;Referer&quot; Referer :&gt; Get '[JSON] Referer
-- &gt;
-- &gt; myApi :: Proxy MyApi
-- &gt; myApi = Proxy
-- &gt;
-- &gt; viewReferer :: Maybe Referer -&gt; ClientM Book
-- &gt; viewReferer = client myApi
-- &gt; -- then you can just use &quot;viewRefer&quot; to query that endpoint
-- &gt; -- specifying Nothing or e.g Just &quot;http://haskell.org/&quot; as arguments
instance (KnownSymbol sym, ToHttpApiData a, HasClient api)
      =&gt; HasClient (Header sym a :&gt; api) where

  type Client (Header sym a :&gt; api) =
    Maybe a -&gt; Client api

  clientWithRoute Proxy req mval =
    clientWithRoute (Proxy :: Proxy api)
                    (maybe req
                           (\value -&gt; Servant.Common.Req.addHeader hname value req)
                           mval
                    )

    where hname = symbolVal (Proxy :: Proxy sym)

-- | Using a 'HttpVersion' combinator in your API doesn't affect the client
-- functions.
instance HasClient api
  =&gt; HasClient (HttpVersion :&gt; api) where

  type Client (HttpVersion :&gt; api) =
    Client api

  clientWithRoute Proxy =
    clientWithRoute (Proxy :: Proxy api)

-- | If you use a 'QueryParam' in one of your endpoints in your API,
-- the corresponding querying function will automatically take
-- an additional argument of the type specified by your 'QueryParam',
-- enclosed in Maybe.
--
-- If you give Nothing, nothing will be added to the query string.
--
-- If you give a non-'Nothing' value, this function will take care
-- of inserting a textual representation of this value in the query string.
--
-- You can control how values for your type are turned into
-- text by specifying a 'ToHttpApiData' instance for your type.
--
-- Example:
--
-- &gt; type MyApi = &quot;books&quot; :&gt; QueryParam &quot;author&quot; Text :&gt; Get '[JSON] [Book]
-- &gt;
-- &gt; myApi :: Proxy MyApi
-- &gt; myApi = Proxy
-- &gt;
-- &gt; getBooksBy :: Maybe Text -&gt; ClientM [Book]
-- &gt; getBooksBy = client myApi
-- &gt; -- then you can just use &quot;getBooksBy&quot; to query that endpoint.
-- &gt; -- 'getBooksBy Nothing' for all books
-- &gt; -- 'getBooksBy (Just &quot;Isaac Asimov&quot;)' to get all books by Isaac Asimov
instance (KnownSymbol sym, ToHttpApiData a, HasClient api)
      =&gt; HasClient (QueryParam sym a :&gt; api) where

  type Client (QueryParam sym a :&gt; api) =
    Maybe a -&gt; Client api

  -- if mparam = Nothing, we don't add it to the query string
  clientWithRoute Proxy req mparam =
    clientWithRoute (Proxy :: Proxy api)
                    (maybe req
                           (flip (appendToQueryString pname) req . Just)
                           mparamText
                    )

    where pname  = cs pname'
          pname' = symbolVal (Proxy :: Proxy sym)
          mparamText = fmap toQueryParam mparam

-- | If you use a 'QueryParams' in one of your endpoints in your API,
-- the corresponding querying function will automatically take
-- an additional argument, a list of values of the type specified
-- by your 'QueryParams'.
--
-- If you give an empty list, nothing will be added to the query string.
--
-- Otherwise, this function will take care
-- of inserting a textual representation of your values in the query string,
-- under the same query string parameter name.
--
-- You can control how values for your type are turned into
-- text by specifying a 'ToHttpApiData' instance for your type.
--
-- Example:
--
-- &gt; type MyApi = &quot;books&quot; :&gt; QueryParams &quot;authors&quot; Text :&gt; Get '[JSON] [Book]
-- &gt;
-- &gt; myApi :: Proxy MyApi
-- &gt; myApi = Proxy
-- &gt;
-- &gt; getBooksBy :: [Text] -&gt; ClientM [Book]
-- &gt; getBooksBy = client myApi
-- &gt; -- then you can just use &quot;getBooksBy&quot; to query that endpoint.
-- &gt; -- 'getBooksBy []' for all books
-- &gt; -- 'getBooksBy [&quot;Isaac Asimov&quot;, &quot;Robert A. Heinlein&quot;]'
-- &gt; --   to get all books by Asimov and Heinlein
instance (KnownSymbol sym, ToHttpApiData a, HasClient api)
      =&gt; HasClient (QueryParams sym a :&gt; api) where

  type Client (QueryParams sym a :&gt; api) =
    [a] -&gt; Client api

  clientWithRoute Proxy req paramlist =
    clientWithRoute (Proxy :: Proxy api)
                    (foldl' (\ req' -&gt; maybe req' (flip (appendToQueryString pname) req' . Just))
                            req
                            paramlist'
                    )

    where pname  = cs pname'
          pname' = symbolVal (Proxy :: Proxy sym)
          paramlist' = map (Just . toQueryParam) paramlist

-- | If you use a 'QueryFlag' in one of your endpoints in your API,
-- the corresponding querying function will automatically take
-- an additional 'Bool' argument.
--
-- If you give 'False', nothing will be added to the query string.
--
-- Otherwise, this function will insert a value-less query string
-- parameter under the name associated to your 'QueryFlag'.
--
-- Example:
--
-- &gt; type MyApi = &quot;books&quot; :&gt; QueryFlag &quot;published&quot; :&gt; Get '[JSON] [Book]
-- &gt;
-- &gt; myApi :: Proxy MyApi
-- &gt; myApi = Proxy
-- &gt;
-- &gt; getBooks :: Bool -&gt; ClientM [Book]
-- &gt; getBooks = client myApi
-- &gt; -- then you can just use &quot;getBooks&quot; to query that endpoint.
-- &gt; -- 'getBooksBy False' for all books
-- &gt; -- 'getBooksBy True' to only get _already published_ books
instance (KnownSymbol sym, HasClient api)
      =&gt; HasClient (QueryFlag sym :&gt; api) where

  type Client (QueryFlag sym :&gt; api) =
    Bool -&gt; Client api

  clientWithRoute Proxy req flag =
    clientWithRoute (Proxy :: Proxy api)
                    (if flag
                       then appendToQueryString paramname Nothing req
                       else req
                    )

    where paramname = cs $ symbolVal (Proxy :: Proxy sym)


-- | Pick a 'Method' and specify where the server you want to query is. You get
-- back the full `Response`.
instance HasClient Raw where
  type Client Raw
    = H.Method -&gt;  ClientM (Int, ByteString, MediaType, [HTTP.Header], Response ByteString)

  clientWithRoute :: Proxy Raw -&gt; Req -&gt; Client Raw
  clientWithRoute Proxy req httpMethod = do
    performRequest httpMethod req

-- | If you use a 'ReqBody' in one of your endpoints in your API,
-- the corresponding querying function will automatically take
-- an additional argument of the type specified by your 'ReqBody'.
-- That function will take care of encoding this argument as JSON and
-- of using it as the request body.
--
-- All you need is for your type to have a 'ToJSON' instance.
--
-- Example:
--
-- &gt; type MyApi = &quot;books&quot; :&gt; ReqBody '[JSON] Book :&gt; Post '[JSON] Book
-- &gt;
-- &gt; myApi :: Proxy MyApi
-- &gt; myApi = Proxy
-- &gt;
-- &gt; addBook :: Book -&gt; ClientM Book
-- &gt; addBook = client myApi
-- &gt; -- then you can just use &quot;addBook&quot; to query that endpoint
instance (MimeRender ct a, HasClient api)
      =&gt; HasClient (ReqBody (ct ': cts) a :&gt; api) where

  type Client (ReqBody (ct ': cts) a :&gt; api) =
    a -&gt; Client api

  clientWithRoute Proxy req body =
    clientWithRoute (Proxy :: Proxy api)
                    (let ctProxy = Proxy :: Proxy ct
                     in setReqBodyLBS (mimeRender ctProxy body)
                                  -- We use first contentType from the Accept list
                                  (contentType ctProxy)
                                  req
                    )

-- | Make the querying function append @path@ to the request path.
instance (KnownSymbol path, HasClient api) =&gt; HasClient (path :&gt; api) where
  type Client (path :&gt; api) = Client api

  clientWithRoute Proxy req =
     clientWithRoute (Proxy :: Proxy api)
                     (appendToPath p req)

    where p = symbolVal (Proxy :: Proxy path)

instance HasClient api =&gt; HasClient (Vault :&gt; api) where
  type Client (Vault :&gt; api) = Client api

  clientWithRoute Proxy req =
    clientWithRoute (Proxy :: Proxy api) req

instance HasClient api =&gt; HasClient (RemoteHost :&gt; api) where
  type Client (RemoteHost :&gt; api) = Client api

  clientWithRoute Proxy req =
    clientWithRoute (Proxy :: Proxy api) req

instance HasClient api =&gt; HasClient (IsSecure :&gt; api) where
  type Client (IsSecure :&gt; api) = Client api

  clientWithRoute Proxy req =
    clientWithRoute (Proxy :: Proxy api) req

instance HasClient subapi =&gt;
  HasClient (WithNamedContext name context subapi) where

  type Client (WithNamedContext name context subapi) = Client subapi
  clientWithRoute Proxy = clientWithRoute (Proxy :: Proxy subapi)

instance ( HasClient api
         ) =&gt; HasClient (AuthProtect tag :&gt; api) where
  type Client (AuthProtect tag :&gt; api)
    = AuthenticateReq (AuthProtect tag) -&gt; Client api

  clientWithRoute Proxy req (AuthenticateReq (val,func)) =
    clientWithRoute (Proxy :: Proxy api) (func val req)

-- * Basic Authentication

instance HasClient api =&gt; HasClient (BasicAuth realm usr :&gt; api) where
  type Client (BasicAuth realm usr :&gt; api) = BasicAuthData -&gt; Client api

  clientWithRoute Proxy req val =
    clientWithRoute (Proxy :: Proxy api) (basicAuthReq val req)


{- Note [Non-Empty Content Types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Rather than have

   instance (..., cts' ~ (ct ': cts)) =&gt; ... cts' ...

It may seem to make more sense to have:

   instance (...) =&gt; ... (ct ': cts) ...

But this means that if another instance exists that does *not* require
non-empty lists, but is otherwise more specific, no instance will be overall
more specific. This in turn generally means adding yet another instance (one
for empty and one for non-empty lists).
-}
</span></pre></body></html>