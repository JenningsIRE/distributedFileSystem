<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">{-|
  IP routing table is a tree of 'AddrRange'
  to search one of them on the longest
  match base. It is a kind of TRIE with one
  way branching removed. Both IPv4 and IPv6
  are supported.
-}</span><span>
</span><a name="line-10"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IP</span><span class="hs-operator">.</span><span class="hs-identifier">RouteTable</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 709</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator">&lt;$&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-operator">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">pure</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Data.IP.Addr.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IP</span><span class="hs-operator">.</span><span class="hs-identifier">Addr</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Data.IP.Op.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IP</span><span class="hs-operator">.</span><span class="hs-identifier">Op</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="Data.IP.Range.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IP</span><span class="hs-operator">.</span><span class="hs-identifier">Range</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Traversable</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">{-|
  A class to contain IPv4 and IPv6.
-}</span><span>
</span><a name="line-33"></a><span class="hs-keyword">class</span><span> </span><a href="Data.IP.Op.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="#local-6989586621679064413"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Routable"><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier">Routable</span></a></a><span> </span><a name="local-6989586621679064413"><a href="#local-6989586621679064413"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-34"></a><span>    </span><span class="hs-comment">{-|
      The 'intToTBit' function takes 'Int' and returns an 'Routable' address
      whose only n-th bit is set.
    -}</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-identifier">intToTBit</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064413"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-39"></a><span>    </span><span class="hs-comment">{-|
      The 'isZero' function takes an 'Routable' address and an test bit
      'Routable' address and returns 'True' is the bit is unset,
      otherwise returns 'False'.
    -}</span><span>
</span><a name="line-44"></a><span>    </span><span class="hs-identifier">isZero</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679064413"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064413"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="Data.IP.Addr.html#IPv4"><span class="hs-identifier hs-type">IPv4</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-47"></a><span>    </span><a name="local-8214565720323839301"><a href="Data.IP.RouteTable.Internal.html#intToTBit"><span class="hs-identifier">intToTBit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#intToTBitIPv4"><span class="hs-identifier hs-var">intToTBitIPv4</span></a><span>
</span><a name="line-48"></a><span>    </span><a name="local-8214565720323839302"><a href="Data.IP.RouteTable.Internal.html#isZero"><span class="hs-identifier">isZero</span></a></a><span> </span><a name="local-6989586621679064554"><a href="#local-6989586621679064554"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679064555"><a href="#local-6989586621679064555"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064554"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Data.IP.Op.html#masked"><span class="hs-identifier hs-var">masked</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679064555"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Data.IP.Addr.html#IP4"><span class="hs-identifier hs-var">IP4</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="Data.IP.Addr.html#IPv6"><span class="hs-identifier hs-type">IPv6</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-51"></a><span>    </span><a name="local-8214565720323839301"><a href="Data.IP.RouteTable.Internal.html#intToTBit"><span class="hs-identifier">intToTBit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#intToTBitIPv6"><span class="hs-identifier hs-var">intToTBitIPv6</span></a><span>
</span><a name="line-52"></a><span>    </span><a name="local-8214565720323839302"><a href="Data.IP.RouteTable.Internal.html#isZero"><span class="hs-identifier">isZero</span></a></a><span> </span><a name="local-6989586621679064552"><a href="#local-6989586621679064552"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679064553"><a href="#local-6989586621679064553"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064552"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Data.IP.Op.html#masked"><span class="hs-identifier hs-var">masked</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679064553"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Data.IP.Addr.html#IP6"><span class="hs-identifier hs-var">IP6</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-55"></a><span class="hs-comment">--</span><span>
</span><a name="line-56"></a><span class="hs-comment">-- Test Bit</span><span>
</span><a name="line-57"></a><span class="hs-comment">--</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-identifier">intToTBitIPv4</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Addr.html#IPv4"><span class="hs-identifier hs-type">IPv4</span></a><span>
</span><a name="line-60"></a><a name="intToTBitIPv4"><a href="Data.IP.RouteTable.Internal.html#intToTBitIPv4"><span class="hs-identifier">intToTBitIPv4</span></a></a><span> </span><a name="local-6989586621679064441"><a href="#local-6989586621679064441"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Addr.html#IP4"><span class="hs-identifier hs-var">IP4</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#intToTBitsIPv4"><span class="hs-identifier hs-var">intToTBitsIPv4</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679064441"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-identifier">intToTBitIPv6</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Addr.html#IPv6"><span class="hs-identifier hs-type">IPv6</span></a><span>
</span><a name="line-63"></a><a name="intToTBitIPv6"><a href="Data.IP.RouteTable.Internal.html#intToTBitIPv6"><span class="hs-identifier">intToTBitIPv6</span></a></a><span> </span><a name="local-6989586621679064442"><a href="#local-6989586621679064442"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Addr.html#IP6"><span class="hs-identifier hs-var">IP6</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#intToTBitsIPv6"><span class="hs-identifier hs-var">intToTBitsIPv6</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679064442"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-identifier">intToTBitsWord32</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">]</span><span>
</span><a name="line-66"></a><a name="intToTBitsWord32"><a href="Data.IP.RouteTable.Internal.html#intToTBitsWord32"><span class="hs-identifier">intToTBitsWord32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">iterate</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">shift</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-number">0x80000000</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-identifier">intToTBitsIPv4</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="Data.IP.Addr.html#IPv4Addr"><span class="hs-identifier hs-type">IPv4Addr</span></a><span>
</span><a name="line-69"></a><a name="intToTBitsIPv4"><a href="Data.IP.RouteTable.Internal.html#intToTBitsIPv4"><span class="hs-identifier">intToTBitsIPv4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-number">32</span><span class="hs-special">]</span><span> </span><a href="Data.IP.RouteTable.Internal.html#intToTBitsWord32"><span class="hs-identifier hs-var">intToTBitsWord32</span></a><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-identifier">intToTBitsIPv6</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="Data.IP.Addr.html#IPv6Addr"><span class="hs-identifier hs-type">IPv6Addr</span></a><span>
</span><a name="line-72"></a><a name="intToTBitsIPv6"><a href="Data.IP.RouteTable.Internal.html#intToTBitsIPv6"><span class="hs-identifier">intToTBitsIPv6</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-number">128</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679064443"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-74"></a><span>    </span><a name="local-6989586621679064443"><a href="#local-6989586621679064443"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064444"><span class="hs-identifier hs-var">b1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679064445"><span class="hs-identifier hs-var">b2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679064446"><span class="hs-identifier hs-var">b3</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679064447"><span class="hs-identifier hs-var">b4</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679064448"><span class="hs-identifier hs-var">b5</span></a><span>
</span><a name="line-75"></a><span>    </span><a name="local-6989586621679064444"><a href="#local-6989586621679064444"><span class="hs-identifier">b1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679064451"><a href="#local-6989586621679064451"><span class="hs-identifier">vbit</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064451"><span class="hs-identifier hs-var">vbit</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064449"><span class="hs-identifier hs-var">intToTBits</span></a><span>
</span><a name="line-76"></a><span>    </span><a name="local-6989586621679064445"><a href="#local-6989586621679064445"><span class="hs-identifier">b2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679064452"><a href="#local-6989586621679064452"><span class="hs-identifier">vbit</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064452"><span class="hs-identifier hs-var">vbit</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064449"><span class="hs-identifier hs-var">intToTBits</span></a><span>
</span><a name="line-77"></a><span>    </span><a name="local-6989586621679064446"><a href="#local-6989586621679064446"><span class="hs-identifier">b3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679064453"><a href="#local-6989586621679064453"><span class="hs-identifier">vbit</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064453"><span class="hs-identifier hs-var">vbit</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064449"><span class="hs-identifier hs-var">intToTBits</span></a><span>
</span><a name="line-78"></a><span>    </span><a name="local-6989586621679064447"><a href="#local-6989586621679064447"><span class="hs-identifier">b4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679064454"><a href="#local-6989586621679064454"><span class="hs-identifier">vbit</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064454"><span class="hs-identifier hs-var">vbit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064449"><span class="hs-identifier hs-var">intToTBits</span></a><span>
</span><a name="line-79"></a><span>    </span><a name="local-6989586621679064448"><a href="#local-6989586621679064448"><span class="hs-identifier">b5</span></a></a><span> </span><span class="hs-glyph">=</span><span>              </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">,</span><a href="#local-6989586621679064450"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-80"></a><span>    </span><a name="local-6989586621679064449"><a href="#local-6989586621679064449"><span class="hs-identifier">intToTBits</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">32</span><span> </span><a href="Data.IP.RouteTable.Internal.html#intToTBitsWord32"><span class="hs-identifier hs-var">intToTBitsWord32</span></a><span>
</span><a name="line-81"></a><span>    </span><a name="local-6989586621679064450"><a href="#local-6989586621679064450"><span class="hs-identifier">all0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0x00000000</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">{-|
  The Tree structure for IP routing table based on TRIE with
  one way branching removed. This is an abstract data type,
  so you cannot touch its inside. Please use 'insert' or 'lookup', instead.
-}</span><span>
</span><a name="line-90"></a><span class="hs-keyword">data</span><span> </span><a name="IPRTable"><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier">IPRTable</span></a></a><span> </span><a name="local-6989586621679064411"><a href="#local-6989586621679064411"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679064412"><a href="#local-6989586621679064412"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-91"></a><span>    </span><a name="Nil"><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier">Nil</span></a></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Node"><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier">Node</span></a></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064411"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><a href="#local-6989586621679064411"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679064412"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064411"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064412"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064411"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064412"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-comment">{-|
  The 'empty' function returns an empty IP routing table.

&gt;&gt;&gt; (empty :: IPRTable IPv4 ()) == fromList []
True
-}</span><span>
</span><a name="line-103"></a><span class="hs-identifier">empty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064439"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064439"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064440"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-104"></a><a name="empty"><a href="Data.IP.RouteTable.Internal.html#empty"><span class="hs-identifier">empty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064545"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-107"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span>
</span><a name="line-108"></a><span>    </span><span class="hs-identifier">fmap</span><span> </span><a name="local-6989586621679064546"><a href="#local-6989586621679064546"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064547"><a href="#local-6989586621679064547"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679064548"><a href="#local-6989586621679064548"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679064549"><a href="#local-6989586621679064549"><span class="hs-identifier">mv</span></a></a><span> </span><a name="local-6989586621679064550"><a href="#local-6989586621679064550"><span class="hs-identifier">b1</span></a></a><span> </span><a name="local-6989586621679064551"><a href="#local-6989586621679064551"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064547"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679064548"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064546"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679064549"><span class="hs-identifier hs-var">mv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679064546"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679064550"><span class="hs-identifier hs-var">b1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679064546"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679064551"><span class="hs-identifier hs-var">b2</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064540"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>    </span><a name="local-8214565720323789811"><span class="hs-identifier">foldMap</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-identifier">foldMap</span><span> </span><a name="local-6989586621679064541"><a href="#local-6989586621679064541"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679064542"><a href="#local-6989586621679064542"><span class="hs-identifier">mv</span></a></a><span> </span><a name="local-6989586621679064543"><a href="#local-6989586621679064543"><span class="hs-identifier">b1</span></a></a><span> </span><a name="local-6989586621679064544"><a href="#local-6989586621679064544"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621679064541"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679064542"><span class="hs-identifier hs-var">mv</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621679064541"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679064543"><span class="hs-identifier hs-var">b1</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621679064541"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679064544"><span class="hs-identifier hs-var">b2</span></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064533"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-115"></a><span>    </span><a name="local-8214565720323788233"><span class="hs-identifier">traverse</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span>
</span><a name="line-116"></a><span>    </span><span class="hs-identifier">traverse</span><span> </span><a name="local-6989586621679064534"><a href="#local-6989586621679064534"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064535"><a href="#local-6989586621679064535"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679064536"><a href="#local-6989586621679064536"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679064537"><a href="#local-6989586621679064537"><span class="hs-identifier">mv</span></a></a><span> </span><a name="local-6989586621679064538"><a href="#local-6989586621679064538"><span class="hs-identifier">b1</span></a></a><span> </span><a name="local-6989586621679064539"><a href="#local-6989586621679064539"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064535"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679064536"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="#local-6989586621679064534"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679064537"><span class="hs-identifier hs-var">mv</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="#local-6989586621679064534"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679064538"><span class="hs-identifier hs-var">b1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="#local-6989586621679064534"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679064539"><span class="hs-identifier hs-var">b2</span></a><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">{-|
  The 'insert' function inserts a value with a key of 'AddrRange' to 'IPRTable'
  and returns a new 'IPRTable'.

&gt;&gt;&gt; (insert (&quot;127.0.0.1&quot; :: AddrRange IPv4) () empty) == fromList [(&quot;127.0.0.1&quot;,())]
True
-}</span><span>
</span><a name="line-127"></a><span class="hs-identifier">insert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064437"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064437"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064438"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064437"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064438"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064437"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064438"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-128"></a><a name="insert"><a href="Data.IP.RouteTable.Internal.html#insert"><span class="hs-identifier">insert</span></a></a><span> </span><a name="local-6989586621679064455"><a href="#local-6989586621679064455"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679064456"><a href="#local-6989586621679064456"><span class="hs-identifier">v1</span></a></a><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064455"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064457"><span class="hs-identifier hs-var">tb1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679064456"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">)</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span>
</span><a name="line-129"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-130"></a><span>    </span><a name="local-6989586621679064457"><a href="#local-6989586621679064457"><span class="hs-identifier">tb1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#keyToTestBit"><span class="hs-identifier hs-var">keyToTestBit</span></a><span> </span><a href="#local-6989586621679064455"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-131"></a><span class="hs-identifier">insert</span><span> </span><a name="local-6989586621679064458"><a href="#local-6989586621679064458"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679064459"><a href="#local-6989586621679064459"><span class="hs-identifier">v1</span></a></a><span> </span><a name="local-6989586621679064460"><a href="#local-6989586621679064460"><span class="hs-identifier">s</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064461"><a href="#local-6989586621679064461"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621679064462"><a href="#local-6989586621679064462"><span class="hs-identifier">tb2</span></a></a><span> </span><a name="local-6989586621679064463"><a href="#local-6989586621679064463"><span class="hs-identifier">v2</span></a></a><span> </span><a name="local-6989586621679064464"><a href="#local-6989586621679064464"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679064465"><a href="#local-6989586621679064465"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679064461"><span class="hs-identifier hs-var">k2</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064466"><span class="hs-identifier hs-var">tb1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679064459"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064464"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679064465"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064461"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Data.IP.RouteTable.Internal.html#isLeft"><span class="hs-identifier hs-var">isLeft</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064462"><span class="hs-identifier hs-var">tb2</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-134"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064461"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679064462"><span class="hs-identifier hs-var">tb2</span></a><span> </span><a href="#local-6989586621679064463"><span class="hs-identifier hs-var">v2</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#insert"><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064459"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621679064464"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064465"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-135"></a><span>                  </span><span class="hs-keyword">else</span><span>
</span><a name="line-136"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064461"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679064462"><span class="hs-identifier hs-var">tb2</span></a><span> </span><a href="#local-6989586621679064463"><span class="hs-identifier hs-var">v2</span></a><span> </span><a href="#local-6989586621679064464"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#insert"><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064459"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621679064465"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064461"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Data.IP.RouteTable.Internal.html#isLeft"><span class="hs-identifier hs-var">isLeft</span></a><span> </span><a href="#local-6989586621679064461"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679064466"><span class="hs-identifier hs-var">tb1</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-138"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064466"><span class="hs-identifier hs-var">tb1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679064459"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064460"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span>
</span><a name="line-139"></a><span>                  </span><span class="hs-keyword">else</span><span>
</span><a name="line-140"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064466"><span class="hs-identifier hs-var">tb1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679064459"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">)</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><a href="#local-6989586621679064460"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-141"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679064467"><a href="#local-6989586621679064467"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064466"><span class="hs-identifier hs-var">tb1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679064459"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">)</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span>
</span><a name="line-142"></a><span>                </span><span class="hs-keyword">in</span><span> </span><a href="Data.IP.RouteTable.Internal.html#link"><span class="hs-identifier hs-var">link</span></a><span> </span><a href="#local-6989586621679064467"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679064460"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621679064466"><a href="#local-6989586621679064466"><span class="hs-identifier">tb1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#keyToTestBit"><span class="hs-identifier hs-var">keyToTestBit</span></a><span> </span><a href="#local-6989586621679064458"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-identifier">link</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064435"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064435"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064436"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064435"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064436"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064435"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064436"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-147"></a><a name="link"><a href="Data.IP.RouteTable.Internal.html#link"><span class="hs-identifier">link</span></a></a><span> </span><a name="local-6989586621679064468"><a href="#local-6989586621679064468"><span class="hs-identifier">s1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064469"><a href="#local-6989586621679064469"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679064470"><a href="#local-6989586621679064470"><span class="hs-identifier">s2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064471"><a href="#local-6989586621679064471"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Data.IP.RouteTable.Internal.html#isLeft"><span class="hs-identifier hs-var">isLeft</span></a><span> </span><a href="#local-6989586621679064469"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064473"><span class="hs-identifier hs-var">tbg</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064472"><span class="hs-identifier hs-var">kg</span></a><span> </span><a href="#local-6989586621679064473"><span class="hs-identifier hs-var">tbg</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679064468"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679064470"><span class="hs-identifier hs-var">s2</span></a><span>
</span><a name="line-149"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064472"><span class="hs-identifier hs-var">kg</span></a><span> </span><a href="#local-6989586621679064473"><span class="hs-identifier hs-var">tbg</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679064470"><span class="hs-identifier hs-var">s2</span></a><span> </span><a href="#local-6989586621679064468"><span class="hs-identifier hs-var">s1</span></a><span>
</span><a name="line-150"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-151"></a><span>    </span><a name="local-6989586621679064472"><a href="#local-6989586621679064472"><span class="hs-identifier">kg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#glue"><span class="hs-identifier hs-var">glue</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679064469"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064471"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-152"></a><span>    </span><a name="local-6989586621679064473"><a href="#local-6989586621679064473"><span class="hs-identifier">tbg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#keyToTestBit"><span class="hs-identifier hs-var">keyToTestBit</span></a><span> </span><a href="#local-6989586621679064472"><span class="hs-identifier hs-var">kg</span></a><span>
</span><a name="line-153"></a><span class="hs-identifier">link</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;link&quot;</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-identifier">glue</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064434"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064434"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064434"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064434"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-156"></a><a name="glue"><a href="Data.IP.RouteTable.Internal.html#glue"><span class="hs-identifier">glue</span></a></a><span> </span><a name="local-6989586621679064474"><a href="#local-6989586621679064474"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679064475"><a href="#local-6989586621679064475"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679064476"><a href="#local-6989586621679064476"><span class="hs-identifier">k2</span></a></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">addr</span><span> </span><a href="#local-6989586621679064475"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-special">`</span><a href="Data.IP.Op.html#masked"><span class="hs-identifier hs-var">masked</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679064477"><span class="hs-identifier hs-var">mk</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">addr</span><span> </span><a href="#local-6989586621679064476"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">`</span><a href="Data.IP.Op.html#masked"><span class="hs-identifier hs-var">masked</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679064477"><span class="hs-identifier hs-var">mk</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#glue"><span class="hs-identifier hs-var">glue</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064474"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064475"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064476"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-158"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Op.html#makeAddrRange"><span class="hs-identifier hs-var">makeAddrRange</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">addr</span><span> </span><a href="#local-6989586621679064475"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064474"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-160"></a><span>    </span><a name="local-6989586621679064477"><a href="#local-6989586621679064477"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Op.html#intToMask"><span class="hs-identifier hs-var">intToMask</span></a><span> </span><a href="#local-6989586621679064474"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span class="hs-identifier">keyToTestBit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064433"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064433"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064433"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-163"></a><a name="keyToTestBit"><a href="Data.IP.RouteTable.Internal.html#keyToTestBit"><span class="hs-identifier">keyToTestBit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#intToTBit"><span class="hs-identifier hs-var">intToTBit</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">mlen</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-identifier">isLeft</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064432"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064432"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064432"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-166"></a><a name="isLeft"><a href="Data.IP.RouteTable.Internal.html#isLeft"><span class="hs-identifier">isLeft</span></a></a><span> </span><a name="local-6989586621679064478"><a href="#local-6989586621679064478"><span class="hs-identifier">adr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#isZero"><span class="hs-identifier hs-var">isZero</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">addr</span><span> </span><a href="#local-6989586621679064478"><span class="hs-identifier hs-var">adr</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">{-|
  The 'delete' function deletes a value by a key of 'AddrRange' from 'IPRTable'
  and returns a new 'IPRTable'.

&gt;&gt;&gt; delete &quot;127.0.0.1&quot; (insert &quot;127.0.0.1&quot; () empty) == (empty :: IPRTable IPv4 ())
True
-}</span><span>
</span><a name="line-177"></a><span class="hs-identifier">delete</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064430"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064430"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064430"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064431"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064430"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064431"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-178"></a><a name="delete"><a href="Data.IP.RouteTable.Internal.html#delete"><span class="hs-identifier">delete</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span>
</span><a name="line-179"></a><span class="hs-identifier">delete</span><span> </span><a name="local-6989586621679064479"><a href="#local-6989586621679064479"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679064480"><a href="#local-6989586621679064480"><span class="hs-identifier">s</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064481"><a href="#local-6989586621679064481"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621679064482"><a href="#local-6989586621679064482"><span class="hs-identifier">tb2</span></a></a><span> </span><a name="local-6989586621679064483"><a href="#local-6989586621679064483"><span class="hs-identifier">v2</span></a></a><span> </span><a name="local-6989586621679064484"><a href="#local-6989586621679064484"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679064485"><a href="#local-6989586621679064485"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064479"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679064481"><span class="hs-identifier hs-var">k2</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#node"><span class="hs-identifier hs-var">node</span></a><span> </span><a href="#local-6989586621679064481"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679064482"><span class="hs-identifier hs-var">tb2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679064484"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679064485"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-181"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064481"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064479"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Data.IP.RouteTable.Internal.html#isLeft"><span class="hs-identifier hs-var">isLeft</span></a><span> </span><a href="#local-6989586621679064479"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064482"><span class="hs-identifier hs-var">tb2</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-182"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#node"><span class="hs-identifier hs-var">node</span></a><span> </span><a href="#local-6989586621679064481"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679064482"><span class="hs-identifier hs-var">tb2</span></a><span> </span><a href="#local-6989586621679064483"><span class="hs-identifier hs-var">v2</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#delete"><span class="hs-identifier hs-var">delete</span></a><span> </span><a href="#local-6989586621679064479"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064484"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064485"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-183"></a><span>                  </span><span class="hs-keyword">else</span><span>
</span><a name="line-184"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#node"><span class="hs-identifier hs-var">node</span></a><span> </span><a href="#local-6989586621679064481"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679064482"><span class="hs-identifier hs-var">tb2</span></a><span> </span><a href="#local-6989586621679064483"><span class="hs-identifier hs-var">v2</span></a><span> </span><a href="#local-6989586621679064484"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#delete"><span class="hs-identifier hs-var">delete</span></a><span> </span><a href="#local-6989586621679064479"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064485"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064480"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-identifier">node</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064428"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064428"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064428"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679064429"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064428"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064429"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064428"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064429"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064428"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064429"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-188"></a><a name="node"><a href="Data.IP.RouteTable.Internal.html#node"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><a name="local-6989586621679064486"><a href="#local-6989586621679064486"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064486"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-189"></a><span class="hs-identifier">node</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679064487"><a href="#local-6989586621679064487"><span class="hs-identifier">l</span></a></a><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064487"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-190"></a><span class="hs-identifier">node</span><span> </span><a name="local-6989586621679064488"><a href="#local-6989586621679064488"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679064489"><a href="#local-6989586621679064489"><span class="hs-identifier">tb</span></a></a><span> </span><a name="local-6989586621679064490"><a href="#local-6989586621679064490"><span class="hs-identifier">v</span></a></a><span>      </span><a name="local-6989586621679064491"><a href="#local-6989586621679064491"><span class="hs-identifier">l</span></a></a><span>   </span><a name="local-6989586621679064492"><a href="#local-6989586621679064492"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679064488"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679064489"><span class="hs-identifier hs-var">tb</span></a><span> </span><a href="#local-6989586621679064490"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679064491"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679064492"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-comment">{-|
  The 'lookup' function looks up 'IPRTable' with a key of 'AddrRange'.
  If a routing information in 'IPRTable' matches the key, its value
  is returned.

&gt;&gt;&gt; let v4 = [&quot;133.4.0.0/16&quot;,&quot;133.5.0.0/16&quot;,&quot;133.5.16.0/24&quot;,&quot;133.5.23.0/24&quot;] :: [AddrRange IPv4]
&gt;&gt;&gt; let rt = fromList $ zip v4 v4
&gt;&gt;&gt; lookup &quot;127.0.0.1&quot; rt
Nothing
&gt;&gt;&gt; lookup &quot;133.3.0.1&quot; rt
Nothing
&gt;&gt;&gt; lookup &quot;133.4.0.0&quot; rt
Just 133.4.0.0/16
&gt;&gt;&gt; lookup &quot;133.4.0.1&quot; rt
Just 133.4.0.0/16
&gt;&gt;&gt; lookup &quot;133.5.16.0&quot; rt
Just 133.5.16.0/24
&gt;&gt;&gt; lookup &quot;133.5.16.1&quot; rt
Just 133.5.16.0/24
-}</span><span>
</span><a name="line-214"></a><span class="hs-identifier">lookup</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064426"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064426"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064426"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064427"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679064427"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-215"></a><a name="lookup"><a href="Data.IP.RouteTable.Internal.html#lookup"><span class="hs-identifier">lookup</span></a></a><span> </span><a name="local-6989586621679064493"><a href="#local-6989586621679064493"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679064494"><a href="#local-6989586621679064494"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#search"><span class="hs-identifier hs-var">search</span></a><span> </span><a href="#local-6989586621679064493"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679064494"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-identifier">search</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064424"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064424"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064424"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064425"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679064425"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679064425"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-218"></a><a name="search"><a href="Data.IP.RouteTable.Internal.html#search"><span class="hs-identifier">search</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><a name="local-6989586621679064495"><a href="#local-6989586621679064495"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064495"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-219"></a><span class="hs-identifier">search</span><span> </span><a name="local-6989586621679064496"><a href="#local-6989586621679064496"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064497"><a href="#local-6989586621679064497"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621679064498"><a href="#local-6989586621679064498"><span class="hs-identifier">tb2</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679064499"><a href="#local-6989586621679064499"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679064500"><a href="#local-6989586621679064500"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679064501"><a href="#local-6989586621679064501"><span class="hs-identifier">res</span></a></a><span>
</span><a name="line-220"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064496"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679064497"><span class="hs-identifier hs-var">k2</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064501"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-221"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064497"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064496"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Data.IP.RouteTable.Internal.html#isLeft"><span class="hs-identifier hs-var">isLeft</span></a><span> </span><a href="#local-6989586621679064496"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064498"><span class="hs-identifier hs-var">tb2</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-222"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#search"><span class="hs-identifier hs-var">search</span></a><span> </span><a href="#local-6989586621679064496"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064499"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679064501"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-223"></a><span>                  </span><span class="hs-keyword">else</span><span>
</span><a name="line-224"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#search"><span class="hs-identifier hs-var">search</span></a><span> </span><a href="#local-6989586621679064496"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064500"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679064501"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-225"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064501"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-226"></a><span class="hs-identifier">search</span><span> </span><a name="local-6989586621679064502"><a href="#local-6989586621679064502"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064503"><a href="#local-6989586621679064503"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621679064504"><a href="#local-6989586621679064504"><span class="hs-identifier">tb2</span></a></a><span> </span><a name="local-6989586621679064505"><a href="#local-6989586621679064505"><span class="hs-identifier">vl</span></a></a><span> </span><a name="local-6989586621679064506"><a href="#local-6989586621679064506"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679064507"><a href="#local-6989586621679064507"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679064508"><a href="#local-6989586621679064508"><span class="hs-identifier">res</span></a></a><span>
</span><a name="line-227"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064502"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679064503"><span class="hs-identifier hs-var">k2</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064505"><span class="hs-identifier hs-var">vl</span></a><span>
</span><a name="line-228"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064503"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064502"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Data.IP.RouteTable.Internal.html#isLeft"><span class="hs-identifier hs-var">isLeft</span></a><span> </span><a href="#local-6989586621679064502"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064504"><span class="hs-identifier hs-var">tb2</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-229"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#search"><span class="hs-identifier hs-var">search</span></a><span> </span><a href="#local-6989586621679064502"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064506"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679064505"><span class="hs-identifier hs-var">vl</span></a><span>
</span><a name="line-230"></a><span>                  </span><span class="hs-keyword">else</span><span>
</span><a name="line-231"></a><span>                    </span><a href="Data.IP.RouteTable.Internal.html#search"><span class="hs-identifier hs-var">search</span></a><span> </span><a href="#local-6989586621679064502"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064507"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679064505"><span class="hs-identifier hs-var">vl</span></a><span>
</span><a name="line-232"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064508"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-comment">{-|
  The 'findMatch' function looks up 'IPRTable' with a key of 'AddrRange'.
  If the key matches routing informations in 'IPRTable', they are
  returned.

&gt;&gt;&gt; let v4 = [&quot;133.4.0.0/16&quot;,&quot;133.5.0.0/16&quot;,&quot;133.5.16.0/24&quot;,&quot;133.5.23.0/24&quot;] :: [AddrRange IPv4]
&gt;&gt;&gt; let rt = fromList $ zip v4 $ repeat ()
&gt;&gt;&gt; findMatch &quot;133.4.0.0/15&quot; rt :: [(AddrRange IPv4,())]
[(133.4.0.0/16,()),(133.5.0.0/16,()),(133.5.16.0/24,()),(133.5.23.0/24,())]
-}</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-identifier">findMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadPlus</span><span> </span><a href="#local-6989586621679064421"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064422"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064422"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064422"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064423"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064421"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064422"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679064423"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><a name="findMatch"><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier">findMatch</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-249"></a><span class="hs-identifier">findMatch</span><span> </span><a name="local-6989586621679064509"><a href="#local-6989586621679064509"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064510"><a href="#local-6989586621679064510"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679064511"><a href="#local-6989586621679064511"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679064512"><a href="#local-6989586621679064512"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064509"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064510"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a><span> </span><a href="#local-6989586621679064509"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064511"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a><span> </span><a href="#local-6989586621679064509"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064512"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-251"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064510"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064509"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a><span> </span><a href="#local-6989586621679064509"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064511"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a><span> </span><a href="#local-6989586621679064509"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064512"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-252"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-253"></a><span class="hs-identifier">findMatch</span><span> </span><a name="local-6989586621679064513"><a href="#local-6989586621679064513"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064514"><a href="#local-6989586621679064514"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679064515"><a href="#local-6989586621679064515"><span class="hs-identifier">vl</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679064516"><a href="#local-6989586621679064516"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679064517"><a href="#local-6989586621679064517"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064513"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064514"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064514"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679064515"><span class="hs-identifier hs-var">vl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a><span> </span><a href="#local-6989586621679064513"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064516"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a><span> </span><a href="#local-6989586621679064513"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064517"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-255"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679064514"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator hs-var">&gt;:&gt;</span></a><span> </span><a href="#local-6989586621679064513"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a><span> </span><a href="#local-6989586621679064513"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064516"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="Data.IP.RouteTable.Internal.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a><span> </span><a href="#local-6989586621679064513"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679064517"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-256"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-comment">{-|
  The 'fromList' function creates a new IP routing table from
  a list of a pair of 'IPrange' and value.
-}</span><span>
</span><a name="line-264"></a><span class="hs-identifier">fromList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064419"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064419"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679064420"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064419"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064420"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-265"></a><a name="fromList"><a href="Data.IP.RouteTable.Internal.html#fromList"><span class="hs-identifier">fromList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679064518"><a href="#local-6989586621679064518"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679064519"><a href="#local-6989586621679064519"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621679064520"><a href="#local-6989586621679064520"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#insert"><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621679064519"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679064520"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679064518"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="Data.IP.RouteTable.Internal.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">{-|
  The 'toList' function creates a list of a pair of 'AddrRange' and
  value from an IP routing table.
-}</span><span>
</span><a name="line-271"></a><span class="hs-identifier">toList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.RouteTable.Internal.html#Routable"><span class="hs-identifier hs-type">Routable</span></a><span> </span><a href="#local-6989586621679064417"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064417"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064418"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679064417"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679064418"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-272"></a><a name="toList"><a href="Data.IP.RouteTable.Internal.html#toList"><span class="hs-identifier">toList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#foldt"><span class="hs-identifier hs-var">foldt</span></a><span> </span><a href="#local-6989586621679064521"><span class="hs-identifier hs-var">toL</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-273"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-274"></a><span>    </span><a name="local-6989586621679064521"><a href="#local-6989586621679064521"><span class="hs-identifier">toL</span></a></a><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><a name="local-6989586621679064522"><a href="#local-6989586621679064522"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064522"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-275"></a><span>    </span><span class="hs-identifier">toL</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679064523"><a href="#local-6989586621679064523"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064523"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-276"></a><span>    </span><span class="hs-identifier">toL</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679064524"><a href="#local-6989586621679064524"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679064525"><a href="#local-6989586621679064525"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679064526"><a href="#local-6989586621679064526"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064524"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679064525"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679064526"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-identifier">foldt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064414"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064415"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064416"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064416"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064416"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.RouteTable.Internal.html#IPRTable"><span class="hs-identifier hs-type">IPRTable</span></a><span> </span><a href="#local-6989586621679064414"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679064415"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064416"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-281"></a><a name="foldt"><a href="Data.IP.RouteTable.Internal.html#foldt"><span class="hs-identifier">foldt</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679064527"><a href="#local-6989586621679064527"><span class="hs-identifier">v</span></a></a><span> </span><a href="Data.IP.RouteTable.Internal.html#Nil"><span class="hs-identifier hs-var">Nil</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064527"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-282"></a><span class="hs-identifier">foldt</span><span> </span><a name="local-6989586621679064528"><a href="#local-6989586621679064528"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621679064529"><a href="#local-6989586621679064529"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679064530"><a href="#local-6989586621679064530"><span class="hs-identifier">rt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679064531"><a href="#local-6989586621679064531"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679064532"><a href="#local-6989586621679064532"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.RouteTable.Internal.html#foldt"><span class="hs-identifier hs-var">foldt</span></a><span> </span><a href="#local-6989586621679064528"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.RouteTable.Internal.html#foldt"><span class="hs-identifier hs-var">foldt</span></a><span> </span><a href="#local-6989586621679064528"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064528"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679064530"><span class="hs-identifier hs-var">rt</span></a><span> </span><a href="#local-6989586621679064529"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064531"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064532"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-283"></a></pre></body></html>