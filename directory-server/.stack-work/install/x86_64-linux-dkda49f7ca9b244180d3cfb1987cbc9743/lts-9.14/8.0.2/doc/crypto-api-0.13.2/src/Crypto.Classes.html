<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE ParallelListComp #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">{-|
 Maintainer: Thomas.DuBuisson@gmail.com
 Stability: beta
 Portability: portable 

This is the heart of the crypto-api package.  By making (or having) 
an instance of Hash, AsymCipher, BlockCipher or StreamCipher you provide (or obtain)
access to any infrastructure built on these primitives include block cipher modes
of operation, hashing, hmac, signing, etc.  These classes allow users to build
routines that are agnostic to the algorithm used so changing algorithms is as simple
as changing a type signature.
-}</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Classes</span><span>
</span><a name="line-17"></a><span>        </span><span class="hs-special">(</span><span>
</span><a name="line-18"></a><span>        </span><span class="hs-comment">-- * Hash class and helper functions</span><span>
</span><a name="line-19"></a><span>          </span><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#hashFunc%27"><span class="hs-identifier hs-var">hashFunc'</span></a><span>
</span><a name="line-21"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#hashFunc"><span class="hs-identifier hs-var">hashFunc</span></a><span>
</span><a name="line-22"></a><span>        </span><span class="hs-comment">-- * Cipher classes and helper functions</span><span>
</span><a name="line-23"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a><span>
</span><a name="line-25"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#keyLengthBytes"><span class="hs-identifier hs-var">keyLengthBytes</span></a><span>
</span><a name="line-26"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#buildKeyIO"><span class="hs-identifier hs-var">buildKeyIO</span></a><span>
</span><a name="line-27"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#buildKeyGen"><span class="hs-identifier hs-var">buildKeyGen</span></a><span>
</span><a name="line-28"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier hs-type">StreamCipher</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#buildStreamKeyIO"><span class="hs-identifier hs-var">buildStreamKeyIO</span></a><span>
</span><a name="line-30"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#buildStreamKeyGen"><span class="hs-identifier hs-var">buildStreamKeyGen</span></a><span>
</span><a name="line-31"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#AsymCipher"><span class="hs-identifier hs-type">AsymCipher</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#buildKeyPairIO"><span class="hs-identifier hs-var">buildKeyPairIO</span></a><span>
</span><a name="line-33"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#buildKeyPairGen"><span class="hs-identifier hs-var">buildKeyPairGen</span></a><span>
</span><a name="line-34"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#Signing"><span class="hs-identifier hs-type">Signing</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#buildSigningKeyPairIO"><span class="hs-identifier hs-var">buildSigningKeyPairIO</span></a><span>
</span><a name="line-36"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#buildSigningKeyPairGen"><span class="hs-identifier hs-var">buildSigningKeyPairGen</span></a><span>
</span><a name="line-37"></a><span>        </span><span class="hs-comment">-- * Misc helper functions</span><span>
</span><a name="line-38"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">encode</span><span>
</span><a name="line-39"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#zeroIV"><span class="hs-identifier hs-var">zeroIV</span></a><span>
</span><a name="line-40"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a><span>
</span><a name="line-41"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#getIV"><span class="hs-identifier hs-var">getIV</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#getIVIO"><span class="hs-identifier hs-var">getIVIO</span></a><span>
</span><a name="line-42"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a><span>
</span><a name="line-43"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span><span>
</span><a name="line-44"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span>
</span><a name="line-45"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Serialize</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Serialize</span><span class="hs-operator">.</span><span class="hs-identifier">Get</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">SG</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Serialize</span><span class="hs-operator">.</span><span class="hs-identifier">Put</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">SP</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">I</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeUseAsCStringLen</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Trans</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Trans</span><span class="hs-operator">.</span><span class="hs-identifier">State</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">StateT</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">runStateT</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">genericDrop</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Tagged</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Proxy</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="Crypto.Types.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="Crypto.Random.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="Crypto.Util.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafePerformIO</span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CChar</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CInt</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Entropy</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="Crypto.Modes.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Modes</span></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- |The Hash class is intended as the generic interface</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- targeted by maintainers of Haskell digest implementations.</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- Using this generic interface, higher level functions</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- such as 'hash' and 'hash'' provide a useful API</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- for comsumers of hash implementations.</span><span>
</span><a name="line-78"></a><span class="hs-comment">--</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- Any instantiated implementation must handle unaligned data.</span><span>
</span><a name="line-80"></a><span class="hs-comment">--</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- Minimum complete definition: 'outputLength', 'blockLength', 'initialCtx',</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- 'updateCtx', and 'finalize'.</span><span>
</span><a name="line-83"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Hash"><a href="Crypto.Classes.html#Hash"><span class="hs-identifier">Hash</span></a></a><span> </span><a name="local-6989586621679065521"><a href="#local-6989586621679065521"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679065522"><a href="#local-6989586621679065522"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ctx</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-identifier">outputLength</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>         </span><span class="hs-comment">-- ^ The size of the digest when encoded</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-identifier">blockLength</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>         </span><span class="hs-comment">-- ^ The amount of data operated on in each round of the digest computation</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-identifier">initialCtx</span><span>    </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065521"><span class="hs-identifier hs-type">ctx</span></a><span>                        </span><span class="hs-comment">-- ^ An initial context, provided with the first call to 'updateCtx'</span><span>
</span><a name="line-88"></a><span>  </span><span class="hs-identifier">updateCtx</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065521"><span class="hs-identifier hs-type">ctx</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065521"><span class="hs-identifier hs-type">ctx</span></a><span> </span><span class="hs-comment">-- ^ Used to update a context, repeatedly called until all data is exhausted</span><span>
</span><a name="line-89"></a><span>                                              </span><span class="hs-comment">--   must operate correctly for imputs of @n*blockLength@ bytes for @n `elem` [0..]@</span><span>
</span><a name="line-90"></a><span>  </span><span class="hs-identifier">finalize</span><span>      </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065521"><span class="hs-identifier hs-type">ctx</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span>   </span><span class="hs-comment">-- ^ Finializing a context, plus any message data less than the block size, into a digest</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-comment">-- |Hash a lazy ByteString, creating a digest</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-identifier">hash</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a><span> </span><a href="#local-6989586621679065521"><span class="hs-identifier hs-type">ctx</span></a><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span>
</span><a name="line-94"></a><span>  </span><a name="local-8214565720323840368"><a href="Crypto.Classes.html#hash"><span class="hs-identifier">hash</span></a></a><span> </span><a name="local-6989586621679065523"><a href="#local-6989586621679065523"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679065524"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-95"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-96"></a><span>    </span><a name="local-6989586621679065524"><a href="#local-6989586621679065524"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#finalize"><span class="hs-identifier hs-var">finalize</span></a><span> </span><a href="#local-6989586621679065525"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679065527"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-97"></a><span>    </span><a name="local-6989586621679065525"><a href="#local-6989586621679065525"><span class="hs-identifier">ctx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="Crypto.Classes.html#updateCtx"><span class="hs-identifier hs-var">updateCtx</span></a><span> </span><a href="Crypto.Classes.html#initialCtx"><span class="hs-identifier hs-var">initialCtx</span></a><span> </span><a href="#local-6989586621679065526"><span class="hs-identifier hs-var">blks</span></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679065526"><a href="#local-6989586621679065526"><span class="hs-identifier">blks</span></a></a><span class="hs-special">,</span><a name="local-6989586621679065527"><a href="#local-6989586621679065527"><span class="hs-identifier">end</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#makeBlocks"><span class="hs-identifier hs-var">makeBlocks</span></a><span> </span><a href="#local-6989586621679065523"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679065528"><span class="hs-identifier hs-var">blockLen</span></a><span>
</span><a name="line-99"></a><span>    </span><a name="local-6989586621679065528"><a href="#local-6989586621679065528"><span class="hs-identifier">blockLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#blockLength"><span class="hs-identifier hs-var">blockLength</span></a><span> </span><a href="Crypto.Util.html#.%3A%3A."><span class="hs-operator hs-var">.::.</span></a><span> </span><a href="#local-6989586621679065524"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>  </span><span class="hs-comment">-- |Hash a strict ByteString, creating a digest</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-identifier">hash'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a><span> </span><a href="#local-6989586621679065521"><span class="hs-identifier hs-type">ctx</span></a><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065522"><span class="hs-identifier hs-type">d</span></a><span>
</span><a name="line-103"></a><span>  </span><a name="local-8214565720323840369"><a href="Crypto.Classes.html#hash%27"><span class="hs-identifier">hash'</span></a></a><span> </span><a name="local-6989586621679066581"><a href="#local-6989586621679066581"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066582"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-105"></a><span>    </span><a name="local-6989586621679066582"><a href="#local-6989586621679066582"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#finalize"><span class="hs-identifier hs-var">finalize</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#updateCtx"><span class="hs-identifier hs-var">updateCtx</span></a><span> </span><a href="Crypto.Classes.html#initialCtx"><span class="hs-identifier hs-var">initialCtx</span></a><span> </span><a href="#local-6989586621679066583"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066584"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-106"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679066583"><a href="#local-6989586621679066583"><span class="hs-identifier">top</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679066584"><a href="#local-6989586621679066584"><span class="hs-identifier">end</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621679066585"><span class="hs-identifier hs-var">remlen</span></a><span> </span><a href="#local-6989586621679066581"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-107"></a><span>    </span><a name="local-6989586621679066585"><a href="#local-6989586621679066585"><span class="hs-identifier">remlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066581"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066581"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">rem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066586"><span class="hs-identifier hs-var">bLen</span></a><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>    </span><a name="local-6989586621679066586"><a href="#local-6989586621679066586"><span class="hs-identifier">bLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#blockLength"><span class="hs-identifier hs-var">blockLength</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066582"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">-- |Obtain a lazy hash function whose result is the same type</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- as the given digest, which is discarded.  If the type is already inferred then</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- consider using the 'hash' function instead.</span><span>
</span><a name="line-113"></a><span class="hs-identifier">hashFunc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a><span> </span><a href="#local-6989586621679066649"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679066650"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066650"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066650"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-114"></a><a name="hashFunc"><a href="Crypto.Classes.html#hashFunc"><span class="hs-identifier">hashFunc</span></a></a><span> </span><a name="local-6989586621679066651"><a href="#local-6989586621679066651"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066652"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-115"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-116"></a><span>  </span><a name="local-6989586621679066652"><a href="#local-6989586621679066652"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#hash"><span class="hs-identifier hs-var">hash</span></a><span>
</span><a name="line-117"></a><span>  </span><a name="local-6989586621679066653"><a href="#local-6989586621679066653"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066652"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asTypeOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066651"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-comment">-- |Obtain a strict hash function whose result is the same type</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- as the given digest, which is discarded.  If the type is already inferred then</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- consider using the 'hash'' function instead.</span><span>
</span><a name="line-122"></a><span class="hs-identifier">hashFunc'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#Hash"><span class="hs-identifier hs-type">Hash</span></a><span> </span><a href="#local-6989586621679066647"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679066648"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066648"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066648"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><a name="hashFunc%27"><a href="Crypto.Classes.html#hashFunc%27"><span class="hs-identifier">hashFunc'</span></a></a><span> </span><a name="local-6989586621679066683"><a href="#local-6989586621679066683"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066684"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-124"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-125"></a><span>  </span><a name="local-6989586621679066684"><a href="#local-6989586621679066684"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#hash%27"><span class="hs-identifier hs-var">hash'</span></a><span>
</span><a name="line-126"></a><span>  </span><a name="local-6989586621679066685"><a href="#local-6989586621679066685"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066684"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asTypeOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066683"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-pragma">{-# INLINABLE makeBlocks #-}</span><span>
</span><a name="line-129"></a><span class="hs-identifier">makeBlocks</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><a name="makeBlocks"><a href="Crypto.Classes.html#makeBlocks"><span class="hs-identifier">makeBlocks</span></a></a><span> </span><a name="local-6989586621679066686"><a href="#local-6989586621679066686"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679066687"><a href="#local-6989586621679066687"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066688"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toChunks</span><span> </span><a href="#local-6989586621679066686"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-132"></a><span>  </span><a name="local-6989586621679066688"><a href="#local-6989586621679066688"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>  </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679066689"><a href="#local-6989586621679066689"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679066690"><a href="#local-6989586621679066690"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066689"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679066687"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-135"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066691"><a href="#local-6989586621679066691"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066689"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066689"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">rem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066687"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-136"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679066692"><a href="#local-6989586621679066692"><span class="hs-identifier">top</span></a></a><span class="hs-special">,</span><a name="local-6989586621679066693"><a href="#local-6989586621679066693"><span class="hs-identifier">end</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621679066691"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679066689"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-137"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679066694"><a href="#local-6989586621679066694"><span class="hs-identifier">rest</span></a></a><span class="hs-special">,</span><a name="local-6989586621679066695"><a href="#local-6989586621679066695"><span class="hs-identifier">trueEnd</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066688"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066693"><span class="hs-identifier hs-var">end</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679066690"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066692"><span class="hs-identifier hs-var">top</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679066694"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066695"><span class="hs-identifier hs-var">trueEnd</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-140"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679066690"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-141"></a><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066689"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621679066696"><a href="#local-6989586621679066696"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066688"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-6989586621679066689"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679066696"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">-- |The BlockCipher class is intended as the generic interface</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- targeted by maintainers of Haskell cipher implementations.</span><span>
</span><a name="line-146"></a><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- Minimum complete definition: blockSize, encryptBlock, decryptBlock,</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- buildKey, and keyLength.</span><span>
</span><a name="line-149"></a><span class="hs-comment">--</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- Instances must handle unaligned data</span><span>
</span><a name="line-151"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="BlockCipher"><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier">BlockCipher</span></a></a><span> </span><a name="local-6989586621679065520"><a href="#local-6989586621679065520"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-152"></a><span>  </span><span class="hs-identifier">blockSize</span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>                   </span><span class="hs-comment">-- ^ The size of a single block; the smallest unit on which the cipher operates.</span><span>
</span><a name="line-153"></a><span>  </span><span class="hs-identifier">encryptBlock</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>    </span><span class="hs-comment">-- ^ encrypt data of size @n*blockSize@ where @n `elem` [0..]@  (ecb encryption)</span><span>
</span><a name="line-154"></a><span>  </span><span class="hs-identifier">decryptBlock</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>    </span><span class="hs-comment">-- ^ decrypt data of size @n*blockSize@ where @n `elem` [0..]@  (ecb decryption)</span><span>
</span><a name="line-155"></a><span>  </span><span class="hs-identifier">buildKey</span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span>              </span><span class="hs-comment">-- ^ smart constructor for keys from a bytestring.</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-identifier">keyLength</span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>                   </span><span class="hs-comment">-- ^ length of the cryptographic key</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span>  </span><span class="hs-comment">-- * Modes of operation over strict bytestrings</span><span>
</span><a name="line-159"></a><span>  </span><span class="hs-comment">-- | Electronic Cookbook (encryption)</span><span>
</span><a name="line-160"></a><span>  </span><span class="hs-identifier">ecb</span><span>           </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-161"></a><span>  </span><a name="local-8214565720323840338"><a href="Crypto.Classes.html#ecb"><span class="hs-identifier">ecb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeEcb%27"><span class="hs-identifier hs-var">modeEcb'</span></a><span>
</span><a name="line-162"></a><span>  </span><span class="hs-comment">-- | Electronic Cookbook (decryption)</span><span>
</span><a name="line-163"></a><span>  </span><span class="hs-identifier">unEcb</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-164"></a><span>  </span><a name="local-8214565720323840339"><a href="Crypto.Classes.html#unEcb"><span class="hs-identifier">unEcb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnEcb%27"><span class="hs-identifier hs-var">modeUnEcb'</span></a><span>
</span><a name="line-165"></a><span>  </span><span class="hs-comment">-- | Cipherblock Chaining (encryption)</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-identifier">cbc</span><span>           </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>  </span><a name="local-8214565720323840340"><a href="Crypto.Classes.html#cbc"><span class="hs-identifier">cbc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeCbc%27"><span class="hs-identifier hs-var">modeCbc'</span></a><span>
</span><a name="line-168"></a><span>  </span><span class="hs-comment">-- | Cipherblock Chaining (decryption)</span><span>
</span><a name="line-169"></a><span>  </span><span class="hs-identifier">unCbc</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>  </span><a name="local-8214565720323840341"><a href="Crypto.Classes.html#unCbc"><span class="hs-identifier">unCbc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnCbc%27"><span class="hs-identifier hs-var">modeUnCbc'</span></a><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>  </span><span class="hs-comment">-- | Counter (encryption)</span><span>
</span><a name="line-173"></a><span>  </span><span class="hs-identifier">ctr</span><span>           </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>  </span><a name="local-8214565720323840342"><a href="Crypto.Classes.html#ctr"><span class="hs-identifier">ctr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeCtr%27"><span class="hs-identifier hs-var">modeCtr'</span></a><span> </span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>  </span><span class="hs-comment">-- | Counter (decryption)</span><span>
</span><a name="line-177"></a><span>  </span><span class="hs-identifier">unCtr</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>  </span><a name="local-8214565720323840343"><a href="Crypto.Classes.html#unCtr"><span class="hs-identifier">unCtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnCtr%27"><span class="hs-identifier hs-var">modeUnCtr'</span></a><span> </span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span>  </span><span class="hs-comment">-- | Counter (encryption)</span><span>
</span><a name="line-181"></a><span>  </span><span class="hs-identifier">ctrLazy</span><span>           </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>  </span><a name="local-8214565720323840344"><a href="Crypto.Classes.html#ctrLazy"><span class="hs-identifier">ctrLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeCtr"><span class="hs-identifier hs-var">modeCtr</span></a><span> </span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span>  </span><span class="hs-comment">-- | Counter (decryption)</span><span>
</span><a name="line-185"></a><span>  </span><span class="hs-identifier">unCtrLazy</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>  </span><a name="local-8214565720323840345"><a href="Crypto.Classes.html#unCtrLazy"><span class="hs-identifier">unCtrLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier hs-var">modeUnCtr</span></a><span> </span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-comment">-- | Ciphertext feedback (encryption)</span><span>
</span><a name="line-189"></a><span>  </span><span class="hs-identifier">cfb</span><span>           </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>  </span><a name="local-8214565720323840346"><a href="Crypto.Classes.html#cfb"><span class="hs-identifier">cfb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeCfb%27"><span class="hs-identifier hs-var">modeCfb'</span></a><span>
</span><a name="line-191"></a><span>  </span><span class="hs-comment">-- | Ciphertext feedback (decryption)</span><span>
</span><a name="line-192"></a><span>  </span><span class="hs-identifier">unCfb</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>  </span><a name="local-8214565720323840347"><a href="Crypto.Classes.html#unCfb"><span class="hs-identifier">unCfb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnCfb%27"><span class="hs-identifier hs-var">modeUnCfb'</span></a><span>
</span><a name="line-194"></a><span>  </span><span class="hs-comment">-- | Output feedback (encryption)</span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-identifier">ofb</span><span>           </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>  </span><a name="local-8214565720323840348"><a href="Crypto.Classes.html#ofb"><span class="hs-identifier">ofb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeOfb%27"><span class="hs-identifier hs-var">modeOfb'</span></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span>  </span><span class="hs-comment">-- | Output feedback (decryption)</span><span>
</span><a name="line-199"></a><span>  </span><span class="hs-identifier">unOfb</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>  </span><a name="local-8214565720323840349"><a href="Crypto.Classes.html#unOfb"><span class="hs-identifier">unOfb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnOfb%27"><span class="hs-identifier hs-var">modeUnOfb'</span></a><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-comment">-- |Cipher block chaining encryption for lazy bytestrings</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-identifier">cbcLazy</span><span>       </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>  </span><a name="local-8214565720323840350"><a href="Crypto.Classes.html#cbcLazy"><span class="hs-identifier">cbcLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeCbc"><span class="hs-identifier hs-var">modeCbc</span></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span>  </span><span class="hs-comment">-- |Cipher block chaining decryption for lazy bytestrings</span><span>
</span><a name="line-207"></a><span>  </span><span class="hs-identifier">unCbcLazy</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>  </span><a name="local-8214565720323840351"><a href="Crypto.Classes.html#unCbcLazy"><span class="hs-identifier">unCbcLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnCbc"><span class="hs-identifier hs-var">modeUnCbc</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span>  </span><span class="hs-comment">-- |SIV (Synthetic IV) mode for lazy bytestrings. The third argument is</span><span>
</span><a name="line-211"></a><span>  </span><span class="hs-comment">-- the optional list of bytestrings to be authenticated but not</span><span>
</span><a name="line-212"></a><span>  </span><span class="hs-comment">-- encrypted As required by the specification this algorithm may</span><span>
</span><a name="line-213"></a><span>  </span><span class="hs-comment">-- return nothing when certain constraints aren't met.</span><span>
</span><a name="line-214"></a><span>  </span><span class="hs-identifier">sivLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-215"></a><span>  </span><a name="local-8214565720323840352"><a href="Crypto.Classes.html#sivLazy"><span class="hs-identifier">sivLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeSiv"><span class="hs-identifier hs-var">modeSiv</span></a><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span>  </span><span class="hs-comment">-- |SIV (Synthetic IV) for lazy bytestrings.  The third argument is the</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-comment">-- optional list of bytestrings to be authenticated but not encrypted.</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-comment">-- As required by the specification this algorithm may return nothing</span><span>
</span><a name="line-220"></a><span>  </span><span class="hs-comment">-- when authentication fails.</span><span>
</span><a name="line-221"></a><span>  </span><span class="hs-identifier">unSivLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-222"></a><span>  </span><a name="local-8214565720323840353"><a href="Crypto.Classes.html#unSivLazy"><span class="hs-identifier">unSivLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnSiv"><span class="hs-identifier hs-var">modeUnSiv</span></a><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>  </span><span class="hs-comment">-- |SIV (Synthetic IV) mode for strict bytestrings.  First argument is</span><span>
</span><a name="line-225"></a><span>  </span><span class="hs-comment">-- the optional list of bytestrings to be authenticated but not</span><span>
</span><a name="line-226"></a><span>  </span><span class="hs-comment">-- encrypted.  As required by the specification this algorithm may</span><span>
</span><a name="line-227"></a><span>  </span><span class="hs-comment">-- return nothing when certain constraints aren't met.</span><span>
</span><a name="line-228"></a><span>  </span><span class="hs-identifier">siv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-229"></a><span>  </span><a name="local-8214565720323840354"><a href="Crypto.Classes.html#siv"><span class="hs-identifier">siv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeSiv%27"><span class="hs-identifier hs-var">modeSiv'</span></a><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span>  </span><span class="hs-comment">-- |SIV (Synthetic IV) for strict bytestrings First argument is the</span><span>
</span><a name="line-232"></a><span>  </span><span class="hs-comment">-- optional list of bytestrings to be authenticated but not encrypted</span><span>
</span><a name="line-233"></a><span>  </span><span class="hs-comment">-- As required by the specification this algorithm may return nothing</span><span>
</span><a name="line-234"></a><span>  </span><span class="hs-comment">-- when authentication fails.</span><span>
</span><a name="line-235"></a><span>  </span><span class="hs-identifier">unSiv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-236"></a><span>  </span><a name="local-8214565720323840355"><a href="Crypto.Classes.html#unSiv"><span class="hs-identifier">unSiv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnSiv%27"><span class="hs-identifier hs-var">modeUnSiv'</span></a><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span>  </span><span class="hs-comment">-- |Cook book mode - not really a mode at all.  If you don't know what you're doing, don't use this mode^H^H^H^H library.</span><span>
</span><a name="line-239"></a><span>  </span><span class="hs-identifier">ecbLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-240"></a><span>  </span><a name="local-8214565720323840356"><a href="Crypto.Classes.html#ecbLazy"><span class="hs-identifier">ecbLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeEcb"><span class="hs-identifier hs-var">modeEcb</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span>  </span><span class="hs-comment">-- |ECB decrypt, complementary to `ecb`.</span><span>
</span><a name="line-243"></a><span>  </span><span class="hs-identifier">unEcbLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-244"></a><span>  </span><a name="local-8214565720323840357"><a href="Crypto.Classes.html#unEcbLazy"><span class="hs-identifier">unEcbLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnEcb"><span class="hs-identifier hs-var">modeUnEcb</span></a><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span>  </span><span class="hs-comment">-- |Ciphertext feed-back encryption mode for lazy bytestrings (with s</span><span>
</span><a name="line-247"></a><span>  </span><span class="hs-comment">-- == blockSize)</span><span>
</span><a name="line-248"></a><span>  </span><span class="hs-identifier">cfbLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>  </span><a name="local-8214565720323840358"><a href="Crypto.Classes.html#cfbLazy"><span class="hs-identifier">cfbLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeCfb"><span class="hs-identifier hs-var">modeCfb</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>  </span><span class="hs-comment">-- |Ciphertext feed-back decryption mode for lazy bytestrings (with s</span><span>
</span><a name="line-252"></a><span>  </span><span class="hs-comment">-- == blockSize)</span><span>
</span><a name="line-253"></a><span>  </span><span class="hs-identifier">unCfbLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>  </span><a name="local-8214565720323840359"><a href="Crypto.Classes.html#unCfbLazy"><span class="hs-identifier">unCfbLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnCfb"><span class="hs-identifier hs-var">modeUnCfb</span></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span>  </span><span class="hs-comment">-- |Output feedback mode for lazy bytestrings</span><span>
</span><a name="line-257"></a><span>  </span><span class="hs-identifier">ofbLazy</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>  </span><a name="local-8214565720323840360"><a href="Crypto.Classes.html#ofbLazy"><span class="hs-identifier">ofbLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeOfb"><span class="hs-identifier hs-var">modeOfb</span></a><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>  </span><span class="hs-comment">-- |Output feedback mode for lazy bytestrings</span><span>
</span><a name="line-261"></a><span>  </span><span class="hs-identifier">unOfbLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679065520"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>  </span><a name="local-8214565720323840361"><a href="Crypto.Classes.html#unOfbLazy"><span class="hs-identifier">unOfbLazy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnOfb"><span class="hs-identifier hs-var">modeUnOfb</span></a><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">-- |Output feedback mode for lazy bytestrings</span><span>
</span><a name="line-265"></a><span class="hs-identifier">modeOfb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066646"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066646"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066646"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066646"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-266"></a><a name="modeOfb"><a href="Crypto.Classes.html#modeOfb"><span class="hs-identifier">modeOfb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnOfb"><span class="hs-identifier hs-var">modeUnOfb</span></a><span>
</span><a name="line-267"></a><span class="hs-pragma">{-# INLINEABLE modeOfb #-}</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">-- |Output feedback mode for lazy bytestrings</span><span>
</span><a name="line-270"></a><span class="hs-identifier">modeUnOfb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066645"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066645"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066645"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066645"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><a name="modeUnOfb"><a href="Crypto.Classes.html#modeUnOfb"><span class="hs-identifier">modeUnOfb</span></a></a><span> </span><a name="local-6989586621679066698"><a href="#local-6989586621679066698"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679066699"><a href="#local-6989586621679066699"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679066700"><a href="#local-6989586621679066700"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-272"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066701"><a href="#local-6989586621679066701"><span class="hs-identifier">ivStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">iterate</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679066698"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066699"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-273"></a><span>            </span><a name="local-6989586621679066702"><a href="#local-6989586621679066702"><span class="hs-identifier">ivLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066699"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>            </span><a name="local-6989586621679066703"><a href="#local-6989586621679066703"><span class="hs-identifier">newIV</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toChunks</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679066702"><span class="hs-identifier hs-var">ivLen</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066700"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679066701"><span class="hs-identifier hs-var">ivStr</span></a><span>
</span><a name="line-275"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="Crypto.Util.html#zwp"><span class="hs-identifier hs-var">zwp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><a href="#local-6989586621679066701"><span class="hs-identifier hs-var">ivStr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066700"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066703"><span class="hs-identifier hs-var">newIV</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span class="hs-pragma">{-# INLINEABLE modeUnOfb #-}</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- |Ciphertext feed-back encryption mode for lazy bytestrings (with s</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- == blockSize)</span><span>
</span><a name="line-281"></a><span class="hs-identifier">modeCfb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066644"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066644"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066644"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066644"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-282"></a><a name="modeCfb"><a href="Crypto.Classes.html#modeCfb"><span class="hs-identifier">modeCfb</span></a></a><span> </span><a name="local-6989586621679066887"><a href="#local-6989586621679066887"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679066888"><a href="#local-6989586621679066888"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679066889"><a href="#local-6989586621679066889"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066898"><a href="#local-6989586621679066898"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a><span> </span><a href="#local-6989586621679066887"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066889"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-284"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679066899"><a href="#local-6989586621679066899"><span class="hs-identifier">cs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679066900"><a href="#local-6989586621679066900"><span class="hs-identifier">ivF</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066890"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679066888"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679066898"><span class="hs-identifier hs-var">blks</span></a><span>
</span><a name="line-285"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><a href="#local-6989586621679066899"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679066900"><span class="hs-identifier hs-var">ivF</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-287"></a><span>  </span><a name="local-6989586621679066890"><a href="#local-6989586621679066890"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679066891"><a href="#local-6989586621679066891"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621679066891"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span>  </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679066892"><a href="#local-6989586621679066892"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679066893"><a href="#local-6989586621679066893"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679066894"><a href="#local-6989586621679066894"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-289"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066895"><a href="#local-6989586621679066895"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679066887"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066892"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066893"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-290"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679066896"><a href="#local-6989586621679066896"><span class="hs-identifier">cs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679066897"><a href="#local-6989586621679066897"><span class="hs-identifier">ivFinal</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066890"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679066895"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679066894"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-291"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066895"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679066896"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066897"><span class="hs-identifier hs-var">ivFinal</span></a><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span class="hs-pragma">{-# INLINEABLE modeCfb #-}</span><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span class="hs-comment">-- |Ciphertext feed-back decryption mode for lazy bytestrings (with s</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- == blockSize)</span><span>
</span><a name="line-296"></a><span class="hs-identifier">modeUnCfb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066643"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066643"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066643"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066643"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><a name="modeUnCfb"><a href="Crypto.Classes.html#modeUnCfb"><span class="hs-identifier">modeUnCfb</span></a></a><span> </span><a name="local-6989586621679066901"><a href="#local-6989586621679066901"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679066902"><a href="#local-6989586621679066902"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679066903"><a href="#local-6989586621679066903"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-298"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066912"><a href="#local-6989586621679066912"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a><span> </span><a href="#local-6989586621679066901"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066903"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-299"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679066913"><a href="#local-6989586621679066913"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679066914"><a href="#local-6989586621679066914"><span class="hs-identifier">ivF</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066904"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679066902"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679066912"><span class="hs-identifier hs-var">blks</span></a><span>
</span><a name="line-300"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><a href="#local-6989586621679066913"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679066914"><span class="hs-identifier hs-var">ivF</span></a><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-302"></a><span>  </span><a name="local-6989586621679066904"><a href="#local-6989586621679066904"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679066905"><a href="#local-6989586621679066905"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066905"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>  </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679066906"><a href="#local-6989586621679066906"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679066907"><a href="#local-6989586621679066907"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679066908"><a href="#local-6989586621679066908"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-304"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066909"><a href="#local-6989586621679066909"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679066901"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066906"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066907"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-305"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679066910"><a href="#local-6989586621679066910"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679066911"><a href="#local-6989586621679066911"><span class="hs-identifier">ivF</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066904"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679066907"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679066908"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-306"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066909"><span class="hs-identifier hs-var">p</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679066910"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066911"><span class="hs-identifier hs-var">ivF</span></a><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span class="hs-pragma">{-# INLINEABLE modeUnCfb #-}</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- |Obtain an `IV` using the provided CryptoRandomGenerator.</span><span>
</span><a name="line-310"></a><span class="hs-identifier">getIV</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066641"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679066642"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066642"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066641"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066642"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-311"></a><a name="getIV"><a href="Crypto.Classes.html#getIV"><span class="hs-identifier">getIV</span></a></a><span> </span><a name="local-6989586621679066915"><a href="#local-6989586621679066915"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-312"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066916"><a href="#local-6989586621679066916"><span class="hs-identifier">bytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier hs-var">ivBlockSizeBytes</span></a><span> </span><a href="#local-6989586621679066919"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-313"></a><span>            </span><a name="local-6989586621679066917"><a href="#local-6989586621679066917"><span class="hs-identifier">gen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a><span> </span><a href="#local-6989586621679066916"><span class="hs-identifier hs-var">bytes</span></a><span> </span><a href="#local-6989586621679066915"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-314"></a><span>            </span><a name="local-6989586621679066918"><a href="#local-6989586621679066918"><span class="hs-identifier">fromRight</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679066920"><a href="#local-6989586621679066920"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066920"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-315"></a><span>            </span><a name="local-6989586621679066919"><a href="#local-6989586621679066919"><span class="hs-identifier">iv</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679066918"><span class="hs-identifier hs-var">fromRight</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679066917"><span class="hs-identifier hs-var">gen</span></a><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679066917"><span class="hs-identifier hs-var">gen</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-317"></a><span>                </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679066932"><a href="#local-6989586621679066932"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679066932"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-318"></a><span>                </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679066933"><a href="#local-6989586621679066933"><span class="hs-identifier">bs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679066934"><a href="#local-6989586621679066934"><span class="hs-identifier">g'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066933"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679066916"><span class="hs-identifier hs-var">bytes</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066919"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066934"><span class="hs-identifier hs-var">g'</span></a><span class="hs-special">)</span><span>
</span><a name="line-320"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.html#GenErrorOther"><span class="hs-identifier hs-var">GenErrorOther</span></a><span> </span><span class="hs-string">&quot;Generator failed to provide requested number of bytes&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span class="hs-pragma">{-# INLINEABLE getIV #-}</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span class="hs-comment">-- | Obtain an 'IV' using the system entropy (see 'System.Entropy')</span><span>
</span><a name="line-324"></a><span class="hs-identifier">getIVIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066640"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066640"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-325"></a><a name="getIVIO"><a href="Crypto.Classes.html#getIVIO"><span class="hs-identifier">getIVIO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-326"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066935"><a href="#local-6989586621679066935"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-327"></a><span>            </span><span class="hs-identifier">getTypedIV</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066937"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679066937"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066937"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>            </span><a name="local-6989586621679066936"><a href="#local-6989586621679066936"><span class="hs-identifier">getTypedIV</span></a></a><span> </span><a name="local-6989586621679066938"><a href="#local-6989586621679066938"><span class="hs-identifier">pr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getEntropy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">proxy</span><span> </span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span> </span><a href="#local-6989586621679066938"><span class="hs-identifier hs-var">pr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>        </span><a name="local-6989586621679066939"><a href="#local-6989586621679066939"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679066936"><span class="hs-identifier hs-var">getTypedIV</span></a><span> </span><a href="#local-6989586621679066935"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-330"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066939"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asProxyTypeOf</span><span class="hs-special">`</span><span> </span><a href="Crypto.Classes.html#ivProxy"><span class="hs-identifier hs-var">ivProxy</span></a><span> </span><a href="#local-6989586621679066935"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span class="hs-pragma">{-# INLINEABLE getIVIO #-}</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-identifier">ivProxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679066639"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066639"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><a name="ivProxy"><a href="Crypto.Classes.html#ivProxy"><span class="hs-identifier">ivProxy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-identifier">deIVProxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066638"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679066638"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-337"></a><a name="deIVProxy"><a href="Crypto.Classes.html#deIVProxy"><span class="hs-identifier">deIVProxy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-comment">-- |Cook book mode - not really a mode at all.  If you don't know what you're doing, don't use this mode^H^H^H^H library.</span><span>
</span><a name="line-340"></a><span class="hs-identifier">modeEcb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066637"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066637"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-341"></a><a name="modeEcb"><a href="Crypto.Classes.html#modeEcb"><span class="hs-identifier">modeEcb</span></a></a><span> </span><a name="local-6989586621679066940"><a href="#local-6989586621679066940"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679066941"><a href="#local-6989586621679066941"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-342"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066942"><a href="#local-6989586621679066942"><span class="hs-identifier">chunks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a><span> </span><a href="#local-6989586621679066940"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066941"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-343"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679066940"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066942"><span class="hs-identifier hs-var">chunks</span></a><span>
</span><a name="line-344"></a><span class="hs-pragma">{-# INLINEABLE modeEcb #-}</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-comment">-- |ECB decrypt, complementary to `ecb`.</span><span>
</span><a name="line-347"></a><span class="hs-identifier">modeUnEcb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066636"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066636"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-348"></a><a name="modeUnEcb"><a href="Crypto.Classes.html#modeUnEcb"><span class="hs-identifier">modeUnEcb</span></a></a><span> </span><a name="local-6989586621679066943"><a href="#local-6989586621679066943"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679066944"><a href="#local-6989586621679066944"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-349"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066945"><a href="#local-6989586621679066945"><span class="hs-identifier">chunks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a><span> </span><a href="#local-6989586621679066943"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066944"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-350"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-var">decryptBlock</span></a><span> </span><a href="#local-6989586621679066943"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066945"><span class="hs-identifier hs-var">chunks</span></a><span>
</span><a name="line-351"></a><span class="hs-pragma">{-# INLINEABLE modeUnEcb #-}</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-comment">-- |SIV (Synthetic IV) mode for lazy bytestrings. The third argument is</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- the optional list of bytestrings to be authenticated but not</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- encrypted As required by the specification this algorithm may</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- return nothing when certain constraints aren't met.</span><span>
</span><a name="line-357"></a><span class="hs-identifier">modeSiv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066635"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066635"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066635"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-358"></a><a name="modeSiv"><a href="Crypto.Classes.html#modeSiv"><span class="hs-identifier">modeSiv</span></a></a><span> </span><a name="local-6989586621679066946"><a href="#local-6989586621679066946"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679066947"><a href="#local-6989586621679066947"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621679066948"><a href="#local-6989586621679066948"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679066949"><a href="#local-6989586621679066949"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-359"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066948"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679066951"><span class="hs-identifier hs-var">bSizeb</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-360"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span>
</span><a name="line-361"></a><span>                </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-6989586621679066952"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-362"></a><span>                </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span>
</span><a name="line-363"></a><span>                </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Classes.html#ctrLazy"><span class="hs-identifier hs-var">ctrLazy</span></a><span> </span><a href="#local-6989586621679066947"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var">sivMask</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toChunks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679066952"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>                </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679066949"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-365"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-366"></a><span>       </span><a name="local-6989586621679066950"><a href="#local-6989586621679066950"><span class="hs-identifier">bSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066946"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-367"></a><span>       </span><a name="local-6989586621679066951"><a href="#local-6989586621679066951"><span class="hs-identifier">bSizeb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066946"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-368"></a><span>       </span><a name="local-6989586621679066952"><a href="#local-6989586621679066952"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Modes.html#cMacStar"><span class="hs-identifier hs-var">cMacStar</span></a><span> </span><a href="#local-6989586621679066946"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679066948"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679066949"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- |SIV (Synthetic IV) for lazy bytestrings.  The third argument is the</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- optional list of bytestrings to be authenticated but not encrypted.</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- As required by the specification this algorithm may return nothing</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- when authentication fails.</span><span>
</span><a name="line-375"></a><span class="hs-identifier">modeUnSiv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066634"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066634"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066634"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-376"></a><a name="modeUnSiv"><a href="Crypto.Classes.html#modeUnSiv"><span class="hs-identifier">modeUnSiv</span></a></a><span> </span><a name="local-6989586621679066953"><a href="#local-6989586621679066953"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679066954"><a href="#local-6989586621679066954"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621679066955"><a href="#local-6989586621679066955"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679066956"><a href="#local-6989586621679066956"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066955"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679066958"><span class="hs-identifier hs-var">bSizeb</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-377"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066956"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679066957"><span class="hs-identifier hs-var">bSize</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-378"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679066959"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-special">(</span><a href="Crypto.Modes.html#cMacStar"><span class="hs-identifier hs-var">cMacStar</span></a><span> </span><a href="#local-6989586621679066953"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679066955"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679066961"><span class="hs-identifier hs-var">dm</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-379"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679066961"><span class="hs-identifier hs-var">dm</span></a><span>
</span><a name="line-380"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-381"></a><span>       </span><a name="local-6989586621679066957"><a href="#local-6989586621679066957"><span class="hs-identifier">bSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066953"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-382"></a><span>       </span><a name="local-6989586621679066958"><a href="#local-6989586621679066958"><span class="hs-identifier">bSizeb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066953"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-383"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621679066959"><a href="#local-6989586621679066959"><span class="hs-identifier">iv</span></a></a><span class="hs-special">,</span><a name="local-6989586621679066960"><a href="#local-6989586621679066960"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679066957"><span class="hs-identifier hs-var">bSize</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066956"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-384"></a><span>       </span><a name="local-6989586621679066961"><a href="#local-6989586621679066961"><span class="hs-identifier">dm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier hs-var">modeUnCtr</span></a><span> </span><a href="Crypto.Classes.html#incIV"><span class="hs-identifier hs-var">incIV</span></a><span> </span><a href="#local-6989586621679066954"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var">sivMask</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toChunks</span><span> </span><a href="#local-6989586621679066959"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066960"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-comment">-- |SIV (Synthetic IV) mode for strict bytestrings.  First argument is</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- the optional list of bytestrings to be authenticated but not</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- encrypted.  As required by the specification this algorithm may</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- return nothing when certain constraints aren't met.</span><span>
</span><a name="line-390"></a><span class="hs-identifier">modeSiv'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066633"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066633"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066633"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-391"></a><a name="modeSiv%27"><a href="Crypto.Classes.html#modeSiv%27"><span class="hs-identifier">modeSiv'</span></a></a><span> </span><a name="local-6989586621679066962"><a href="#local-6989586621679066962"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679066963"><a href="#local-6989586621679066963"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621679066964"><a href="#local-6989586621679066964"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679066965"><a href="#local-6989586621679066965"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066964"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679066967"><span class="hs-identifier hs-var">bSizeb</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-392"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-6989586621679066968"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#ctr"><span class="hs-identifier hs-var">Crypto</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Classes</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ctr</span></a><span> </span><a href="#local-6989586621679066963"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var">sivMask</span></a><span> </span><a href="#local-6989586621679066968"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066965"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-393"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-394"></a><span>       </span><a name="local-6989586621679066966"><a href="#local-6989586621679066966"><span class="hs-identifier">bSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066962"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-395"></a><span>       </span><a name="local-6989586621679066967"><a href="#local-6989586621679066967"><span class="hs-identifier">bSizeb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066962"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-396"></a><span>       </span><a name="local-6989586621679066968"><a href="#local-6989586621679066968"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Modes.html#cMacStar%27"><span class="hs-identifier hs-var">cMacStar'</span></a><span> </span><a href="#local-6989586621679066962"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679066964"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679066965"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span>
</span><a name="line-397"></a><span>
</span><a name="line-398"></a><span class="hs-comment">-- |SIV (Synthetic IV) for strict bytestrings First argument is the</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- optional list of bytestrings to be authenticated but not encrypted</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- As required by the specification this algorithm may return nothing</span><span>
</span><a name="line-401"></a><span class="hs-comment">-- when authentication fails.</span><span>
</span><a name="line-402"></a><span class="hs-identifier">modeUnSiv'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066632"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066632"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066632"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-403"></a><a name="modeUnSiv%27"><a href="Crypto.Classes.html#modeUnSiv%27"><span class="hs-identifier">modeUnSiv'</span></a></a><span> </span><a name="local-6989586621679066969"><a href="#local-6989586621679066969"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679066970"><a href="#local-6989586621679066970"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621679066971"><a href="#local-6989586621679066971"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679066972"><a href="#local-6989586621679066972"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066971"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679066974"><span class="hs-identifier hs-var">bSizeb</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-404"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679066972"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679066973"><span class="hs-identifier hs-var">bSize</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-405"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679066975"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-special">(</span><a href="Crypto.Modes.html#cMacStar%27"><span class="hs-identifier hs-var">cMacStar'</span></a><span> </span><a href="#local-6989586621679066969"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679066971"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679066977"><span class="hs-identifier hs-var">dm</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-406"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679066977"><span class="hs-identifier hs-var">dm</span></a><span>
</span><a name="line-407"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-408"></a><span>       </span><a name="local-6989586621679066973"><a href="#local-6989586621679066973"><span class="hs-identifier">bSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066969"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-409"></a><span>       </span><a name="local-6989586621679066974"><a href="#local-6989586621679066974"><span class="hs-identifier">bSizeb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679066969"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-410"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621679066975"><a href="#local-6989586621679066975"><span class="hs-identifier">iv</span></a></a><span class="hs-special">,</span><a name="local-6989586621679066976"><a href="#local-6989586621679066976"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621679066973"><span class="hs-identifier hs-var">bSize</span></a><span> </span><a href="#local-6989586621679066972"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-411"></a><span>       </span><a name="local-6989586621679066977"><a href="#local-6989586621679066977"><span class="hs-identifier">dm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#unCtr"><span class="hs-identifier hs-var">Crypto</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Classes</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unCtr</span></a><span> </span><a href="#local-6989586621679066970"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier hs-var">sivMask</span></a><span> </span><a href="#local-6989586621679066975"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066976"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-identifier">modeCbc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066631"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066631"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066631"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066631"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-415"></a><a name="modeCbc"><a href="Crypto.Classes.html#modeCbc"><span class="hs-identifier">modeCbc</span></a></a><span> </span><a name="local-6989586621679066978"><a href="#local-6989586621679066978"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679066979"><a href="#local-6989586621679066979"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679066980"><a href="#local-6989586621679066980"><span class="hs-identifier">plaintext</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-416"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066989"><a href="#local-6989586621679066989"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a><span> </span><a href="#local-6989586621679066978"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066980"><span class="hs-identifier hs-var">plaintext</span></a><span>
</span><a name="line-417"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679066990"><a href="#local-6989586621679066990"><span class="hs-identifier">cts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679066991"><a href="#local-6989586621679066991"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066981"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679066989"><span class="hs-identifier hs-var">blks</span></a><span> </span><a href="#local-6989586621679066979"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-418"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><a href="#local-6989586621679066990"><span class="hs-identifier hs-var">cts</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679066991"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-419"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-420"></a><span>  </span><a name="local-6989586621679066981"><a href="#local-6989586621679066981"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679066982"><a href="#local-6989586621679066982"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066982"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>  </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679066983"><a href="#local-6989586621679066983"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679066984"><a href="#local-6989586621679066984"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679066985"><a href="#local-6989586621679066985"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-422"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679066986"><a href="#local-6989586621679066986"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679066978"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><a href="#local-6989586621679066985"><span class="hs-identifier hs-var">iv</span></a><span> </span><a href="#local-6989586621679066983"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679066987"><a href="#local-6989586621679066987"><span class="hs-identifier">cs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679066988"><a href="#local-6989586621679066988"><span class="hs-identifier">ivFinal</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066981"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679066984"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679066986"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-424"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066986"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679066987"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066988"><span class="hs-identifier hs-var">ivFinal</span></a><span class="hs-special">)</span><span>
</span><a name="line-425"></a><span class="hs-pragma">{-# INLINEABLE modeCbc #-}</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-identifier">modeUnCbc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066630"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066630"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066630"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066630"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-428"></a><a name="modeUnCbc"><a href="Crypto.Classes.html#modeUnCbc"><span class="hs-identifier">modeUnCbc</span></a></a><span> </span><a name="local-6989586621679066992"><a href="#local-6989586621679066992"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679066993"><a href="#local-6989586621679066993"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679066994"><a href="#local-6989586621679066994"><span class="hs-identifier">ciphertext</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-429"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067003"><a href="#local-6989586621679067003"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier hs-var">chunkFor</span></a><span> </span><a href="#local-6989586621679066992"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066994"><span class="hs-identifier hs-var">ciphertext</span></a><span>
</span><a name="line-430"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067004"><a href="#local-6989586621679067004"><span class="hs-identifier">pts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067005"><a href="#local-6989586621679067005"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066995"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067003"><span class="hs-identifier hs-var">blks</span></a><span> </span><a href="#local-6989586621679066993"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-431"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><a href="#local-6989586621679067004"><span class="hs-identifier hs-var">pts</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679067005"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-433"></a><span>  </span><a name="local-6989586621679066995"><a href="#local-6989586621679066995"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679066996"><a href="#local-6989586621679066996"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066996"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-434"></a><span>  </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679066997"><a href="#local-6989586621679066997"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679066998"><a href="#local-6989586621679066998"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679066999"><a href="#local-6989586621679066999"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-435"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067000"><a href="#local-6989586621679067000"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-var">decryptBlock</span></a><span> </span><a href="#local-6989586621679066992"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679066997"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679066999"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-436"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067001"><a href="#local-6989586621679067001"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067002"><a href="#local-6989586621679067002"><span class="hs-identifier">ivFinal</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679066995"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679066998"><span class="hs-identifier hs-var">cs</span></a><span> </span><a href="#local-6989586621679066997"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-437"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067000"><span class="hs-identifier hs-var">p</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679067001"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067002"><span class="hs-identifier hs-var">ivFinal</span></a><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span class="hs-pragma">{-# INLINEABLE modeUnCbc #-}</span><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-comment">-- |Counter mode for lazy bytestrings</span><span>
</span><a name="line-441"></a><span class="hs-identifier">modeCtr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066629"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066629"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066629"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066629"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066629"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066629"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-442"></a><a name="modeCtr"><a href="Crypto.Classes.html#modeCtr"><span class="hs-identifier">modeCtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier hs-var">modeUnCtr</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-comment">-- |Counter  mode for lazy bytestrings</span><span>
</span><a name="line-445"></a><span class="hs-identifier">modeUnCtr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066628"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066628"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066628"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066628"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066628"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066628"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-446"></a><a name="modeUnCtr"><a href="Crypto.Classes.html#modeUnCtr"><span class="hs-identifier">modeUnCtr</span></a></a><span> </span><a name="local-6989586621679067006"><a href="#local-6989586621679067006"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679067007"><a href="#local-6989586621679067007"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067008"><a href="#local-6989586621679067008"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067009"><a href="#local-6989586621679067009"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-447"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067010"><a href="#local-6989586621679067010"><span class="hs-identifier">ivStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">iterate</span><span> </span><a href="#local-6989586621679067006"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679067008"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-448"></a><span>           </span><a name="local-6989586621679067011"><a href="#local-6989586621679067011"><span class="hs-identifier">ivLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679067008"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-449"></a><span>           </span><a name="local-6989586621679067012"><a href="#local-6989586621679067012"><span class="hs-identifier">newIV</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">genericDrop</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679067011"><span class="hs-identifier hs-var">ivLen</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679067009"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679067011"><span class="hs-identifier hs-var">ivLen</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067010"><span class="hs-identifier hs-var">ivStr</span></a><span>
</span><a name="line-450"></a><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="Crypto.Util.html#zwp"><span class="hs-identifier hs-var">zwp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679067007"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">initializationVector</span><span> </span><a href="#local-6989586621679067010"><span class="hs-identifier hs-var">ivStr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067009"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067012"><span class="hs-identifier hs-var">newIV</span></a><span class="hs-special">)</span><span>
</span><a name="line-451"></a><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-comment">-- |The number of bytes in a block cipher block</span><span>
</span><a name="line-454"></a><span class="hs-identifier">blockSizeBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066627"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679066627"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a><span>
</span><a name="line-455"></a><a name="blockSizeBytes"><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier">blockSizeBytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-comment">-- |The number of bytes in a block cipher key (assuming it is an even</span><span>
</span><a name="line-458"></a><span class="hs-comment">-- multiple of 8 bits)</span><span>
</span><a name="line-459"></a><span class="hs-identifier">keyLengthBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066626"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679066626"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a><span>
</span><a name="line-460"></a><a name="keyLengthBytes"><a href="Crypto.Classes.html#keyLengthBytes"><span class="hs-identifier">keyLengthBytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><a href="Crypto.Classes.html#keyLength"><span class="hs-identifier hs-var">keyLength</span></a><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span class="hs-comment">-- |Build a symmetric key using the system entropy (see 'System.Entropy')</span><span>
</span><a name="line-463"></a><span class="hs-identifier">buildKeyIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066625"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679066625"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-464"></a><a name="buildKeyIO"><a href="Crypto.Classes.html#buildKeyIO"><span class="hs-identifier">buildKeyIO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#buildKeyM"><span class="hs-identifier hs-var">buildKeyM</span></a><span> </span><span class="hs-identifier hs-var">getEntropy</span><span> </span><span class="hs-identifier hs-var">fail</span><span>
</span><a name="line-465"></a><span>
</span><a name="line-466"></a><span class="hs-comment">-- |Build a symmetric key using a given 'Crypto.Random.CryptoRandomGen'</span><span>
</span><a name="line-467"></a><span class="hs-identifier">buildKeyGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066623"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679066624"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066624"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066623"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066624"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-468"></a><a name="buildKeyGen"><a href="Crypto.Classes.html#buildKeyGen"><span class="hs-identifier">buildKeyGen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runStateT</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#buildKeyM"><span class="hs-identifier hs-var">buildKeyM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StateT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Random.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Random.html#GenErrorOther"><span class="hs-identifier hs-var">GenErrorOther</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span class="hs-identifier">buildKeyM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066621"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679066622"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066622"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066622"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679066621"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066622"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679066621"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-471"></a><a name="buildKeyM"><a href="Crypto.Classes.html#buildKeyM"><span class="hs-identifier">buildKeyM</span></a></a><span> </span><a name="local-6989586621679067280"><a href="#local-6989586621679067280"><span class="hs-identifier">getMore</span></a></a><span> </span><a name="local-6989586621679067281"><a href="#local-6989586621679067281"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067282"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-472"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-473"></a><span>  </span><a name="local-6989586621679067282"><a href="#local-6989586621679067282"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-number">1000</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067281"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-string">&quot;Tried 1000 times to generate a key from the system entropy.\
                \  No keys were returned! Perhaps the system entropy is broken\
                \ or perhaps the BlockCipher instance being used has a non-flat\
                \ keyspace.&quot;</span><span>
</span><a name="line-477"></a><span>  </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679067283"><a href="#local-6989586621679067283"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-478"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067284"><a href="#local-6989586621679067284"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#keyLength"><span class="hs-identifier hs-var">keyLength</span></a><span>
</span><a name="line-479"></a><span>    </span><a name="local-6989586621679067285"><a href="#local-6989586621679067285"><span class="hs-identifier">kd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679067280"><span class="hs-identifier hs-var">getMore</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-number">7</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">untag</span><span> </span><a href="#local-6989586621679067284"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-480"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Classes.html#buildKey"><span class="hs-identifier hs-var">buildKey</span></a><span> </span><a href="#local-6989586621679067285"><span class="hs-identifier hs-var">kd</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-481"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679067282"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067283"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679067286"><a href="#local-6989586621679067286"><span class="hs-identifier">k</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679067286"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asTaggedTypeOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679067284"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span class="hs-comment">-- |Asymetric ciphers (common ones being RSA or EC based)</span><span>
</span><a name="line-485"></a><span class="hs-keyword">class</span><span> </span><a name="AsymCipher"><a href="Crypto.Classes.html#AsymCipher"><span class="hs-identifier">AsymCipher</span></a></a><span> </span><a name="local-6989586621679065515"><a href="#local-6989586621679065515"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679065516"><a href="#local-6989586621679065516"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-486"></a><span>  </span><span class="hs-identifier">buildKeyPair</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679065517"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679065517"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679065515"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679065516"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679065517"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ build a public/private key pair using the provided generator</span><span>
</span><a name="line-487"></a><span>  </span><span class="hs-identifier">encryptAsym</span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679065518"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679065518"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065515"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679065518"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Asymetric encryption</span><span>
</span><a name="line-488"></a><span>  </span><span class="hs-identifier">decryptAsym</span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679065519"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679065519"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065516"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679065519"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Asymetric decryption</span><span>
</span><a name="line-489"></a><span>  </span><span class="hs-identifier">publicKeyLength</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065515"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>
</span><a name="line-490"></a><span>  </span><span class="hs-identifier">privateKeyLength</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065516"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span class="hs-comment">-- |Build a pair of asymmetric keys using the system random generator.</span><span>
</span><a name="line-493"></a><span class="hs-identifier">buildKeyPairIO</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#AsymCipher"><span class="hs-identifier hs-type">AsymCipher</span></a><span> </span><a href="#local-6989586621679066619"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-6989586621679066620"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066619"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679066620"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-494"></a><a name="buildKeyPairIO"><a href="Crypto.Classes.html#buildKeyPairIO"><span class="hs-identifier">buildKeyPairIO</span></a></a><span> </span><a name="local-6989586621679067287"><a href="#local-6989586621679067287"><span class="hs-identifier">bl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-495"></a><span>        </span><a name="local-6989586621679067288"><a href="#local-6989586621679067288"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Crypto.Random.html#newGenIO"><span class="hs-identifier hs-var">newGenIO</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Crypto.Random.html#SystemRandom"><span class="hs-identifier hs-type">SystemRandom</span></a><span>
</span><a name="line-496"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Classes.html#buildKeyPair"><span class="hs-identifier hs-var">buildKeyPair</span></a><span> </span><a href="#local-6989586621679067288"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679067287"><span class="hs-identifier hs-var">bl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-497"></a><span>                </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679067289"><a href="#local-6989586621679067289"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679067289"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span>                </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067290"><a href="#local-6989586621679067290"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679067290"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-comment">-- |Flipped 'buildKeyPair' for ease of use with state monads.</span><span>
</span><a name="line-501"></a><span class="hs-identifier">buildKeyPairGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679066616"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#AsymCipher"><span class="hs-identifier hs-type">AsymCipher</span></a><span> </span><a href="#local-6989586621679066617"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-6989586621679066618"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066616"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679066617"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679066618"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679066616"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-502"></a><a name="buildKeyPairGen"><a href="Crypto.Classes.html#buildKeyPairGen"><span class="hs-identifier">buildKeyPairGen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><a href="Crypto.Classes.html#buildKeyPair"><span class="hs-identifier hs-var">buildKeyPair</span></a><span>
</span><a name="line-503"></a><span>
</span><a name="line-504"></a><span class="hs-comment">-- | A stream cipher class.  Instance are expected to work on messages as small as one byte</span><span>
</span><a name="line-505"></a><span class="hs-comment">-- The length of the resulting cipher text should be equal</span><span>
</span><a name="line-506"></a><span class="hs-comment">-- to the length of the input message.</span><span>
</span><a name="line-507"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679065513"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="StreamCipher"><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier">StreamCipher</span></a></a><span> </span><a name="local-6989586621679065513"><a href="#local-6989586621679065513"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679065514"><a href="#local-6989586621679065514"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">iv</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-508"></a><span>  </span><span class="hs-identifier">buildStreamKey</span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679065513"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-509"></a><span>  </span><span class="hs-identifier">encryptStream</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065513"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065514"><span class="hs-identifier hs-type">iv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679065514"><span class="hs-identifier hs-type">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>  </span><span class="hs-identifier">decryptStream</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065513"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065514"><span class="hs-identifier hs-type">iv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679065514"><span class="hs-identifier hs-type">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>  </span><span class="hs-identifier">streamKeyLength</span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679065513"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>
</span><a name="line-512"></a><span>
</span><a name="line-513"></a><span class="hs-comment">-- |Build a stream key using the system random generator</span><span>
</span><a name="line-514"></a><span class="hs-identifier">buildStreamKeyIO</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier hs-type">StreamCipher</span></a><span> </span><a href="#local-6989586621679066614"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679066615"><span class="hs-identifier hs-type">iv</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679066614"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-515"></a><a name="buildStreamKeyIO"><a href="Crypto.Classes.html#buildStreamKeyIO"><span class="hs-identifier">buildStreamKeyIO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#buildStreamKeyM"><span class="hs-identifier hs-var">buildStreamKeyM</span></a><span> </span><span class="hs-identifier hs-var">getEntropy</span><span> </span><span class="hs-identifier hs-var">fail</span><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span class="hs-comment">-- |Build a stream key using the provided random generator</span><span>
</span><a name="line-518"></a><span class="hs-identifier">buildStreamKeyGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier hs-type">StreamCipher</span></a><span> </span><a href="#local-6989586621679066611"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679066612"><span class="hs-identifier hs-type">iv</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679066613"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066613"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066611"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066613"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-519"></a><a name="buildStreamKeyGen"><a href="Crypto.Classes.html#buildStreamKeyGen"><span class="hs-identifier">buildStreamKeyGen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runStateT</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#buildStreamKeyM"><span class="hs-identifier hs-var">buildStreamKeyM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StateT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Random.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Random.html#GenErrorOther"><span class="hs-identifier hs-var">GenErrorOther</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-identifier">buildStreamKeyM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679066608"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Classes.html#StreamCipher"><span class="hs-identifier hs-type">StreamCipher</span></a><span> </span><a href="#local-6989586621679066609"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679066610"><span class="hs-identifier hs-type">iv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066608"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066608"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679066609"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066608"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679066609"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-522"></a><a name="buildStreamKeyM"><a href="Crypto.Classes.html#buildStreamKeyM"><span class="hs-identifier">buildStreamKeyM</span></a></a><span> </span><a name="local-6989586621679067291"><a href="#local-6989586621679067291"><span class="hs-identifier">getMore</span></a></a><span> </span><a name="local-6989586621679067292"><a href="#local-6989586621679067292"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067293"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-524"></a><span>  </span><a name="local-6989586621679067293"><a href="#local-6989586621679067293"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-number">1000</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067292"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-string">&quot;Tried 1000 times to generate a stream key from the system entropy.\
                \  No keys were returned! Perhaps the system entropy is broken\
                \ or perhaps the BlockCipher instance being used has a non-flat\
                \ keyspace.&quot;</span><span>
</span><a name="line-528"></a><span>  </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679067294"><a href="#local-6989586621679067294"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-529"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067295"><a href="#local-6989586621679067295"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#streamKeyLength"><span class="hs-identifier hs-var">streamKeyLength</span></a><span>
</span><a name="line-530"></a><span>    </span><a name="local-6989586621679067296"><a href="#local-6989586621679067296"><span class="hs-identifier">kd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679067291"><span class="hs-identifier hs-var">getMore</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">untag</span><span> </span><a href="#local-6989586621679067295"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Classes.html#buildStreamKey"><span class="hs-identifier hs-var">buildStreamKey</span></a><span> </span><a href="#local-6989586621679067296"><span class="hs-identifier hs-var">kd</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-532"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679067293"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067294"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679067297"><a href="#local-6989586621679067297"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679067297"><span class="hs-identifier hs-var">k'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asTaggedTypeOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679067295"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span class="hs-comment">-- | A class for signing operations which inherently can not be as generic</span><span>
</span><a name="line-536"></a><span class="hs-comment">-- as asymetric ciphers (ex: DSA).</span><span>
</span><a name="line-537"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679065509"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679065510"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Signing"><a href="Crypto.Classes.html#Signing"><span class="hs-identifier">Signing</span></a></a><span> </span><a name="local-6989586621679065509"><a href="#local-6989586621679065509"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679065510"><a href="#local-6989586621679065510"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">p</span><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-538"></a><span>  </span><span class="hs-identifier">sign</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679065511"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679065511"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679065510"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679065511"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>  </span><span class="hs-identifier">verify</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065509"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-540"></a><span>  </span><span class="hs-identifier">buildSigningPair</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679065512"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679065512"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679065509"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679065510"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679065512"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>  </span><span class="hs-identifier">signingKeyLength</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065510"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>
</span><a name="line-542"></a><span>  </span><span class="hs-identifier">verifyingKeyLength</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679065509"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span>
</span><a name="line-543"></a><span>
</span><a name="line-544"></a><span class="hs-comment">-- |Build a signing key using the system random generator</span><span>
</span><a name="line-545"></a><span class="hs-identifier">buildSigningKeyPairIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#Signing"><span class="hs-identifier hs-type">Signing</span></a><span> </span><a href="#local-6989586621679066606"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-6989586621679066607"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679066606"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679066607"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-546"></a><a name="buildSigningKeyPairIO"><a href="Crypto.Classes.html#buildSigningKeyPairIO"><span class="hs-identifier">buildSigningKeyPairIO</span></a></a><span> </span><a name="local-6989586621679067298"><a href="#local-6989586621679067298"><span class="hs-identifier">bl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-547"></a><span>        </span><a name="local-6989586621679067299"><a href="#local-6989586621679067299"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Crypto.Random.html#newGenIO"><span class="hs-identifier hs-var">newGenIO</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Crypto.Random.html#SystemRandom"><span class="hs-identifier hs-type">SystemRandom</span></a><span>
</span><a name="line-548"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Classes.html#buildSigningPair"><span class="hs-identifier hs-var">buildSigningPair</span></a><span> </span><a href="#local-6989586621679067299"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679067298"><span class="hs-identifier hs-var">bl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-549"></a><span>                </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679067300"><a href="#local-6989586621679067300"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679067300"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-550"></a><span>                </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067301"><a href="#local-6989586621679067301"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679067301"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span class="hs-comment">-- |Flipped 'buildSigningPair' for ease of use with state monads.</span><span>
</span><a name="line-553"></a><span class="hs-identifier">buildSigningKeyPairGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#Signing"><span class="hs-identifier hs-type">Signing</span></a><span> </span><a href="#local-6989586621679066603"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-6989586621679066604"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-6989586621679066605"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Types.html#BitLength"><span class="hs-identifier hs-type">BitLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066605"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679066603"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066604"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679066605"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-554"></a><a name="buildSigningKeyPairGen"><a href="Crypto.Classes.html#buildSigningKeyPairGen"><span class="hs-identifier">buildSigningKeyPairGen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><a href="Crypto.Classes.html#buildSigningPair"><span class="hs-identifier hs-var">buildSigningPair</span></a><span>
</span><a name="line-555"></a><span>
</span><a name="line-556"></a><span class="hs-comment">-- | Like `ecb` but for strict bytestrings</span><span>
</span><a name="line-557"></a><span class="hs-identifier">modeEcb'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066602"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066602"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-558"></a><a name="modeEcb%27"><a href="Crypto.Classes.html#modeEcb%27"><span class="hs-identifier">modeEcb'</span></a></a><span> </span><a name="local-6989586621679067302"><a href="#local-6989586621679067302"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679067303"><a href="#local-6989586621679067303"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-559"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067304"><a href="#local-6989586621679067304"><span class="hs-identifier">chunks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a><span> </span><a href="#local-6989586621679067302"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067303"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-560"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679067302"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067304"><span class="hs-identifier hs-var">chunks</span></a><span>
</span><a name="line-561"></a><span class="hs-pragma">{-# INLINE modeEcb' #-}</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-comment">-- |Decryption complement to `ecb'`</span><span>
</span><a name="line-564"></a><span class="hs-identifier">modeUnEcb'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066601"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066601"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-565"></a><a name="modeUnEcb%27"><a href="Crypto.Classes.html#modeUnEcb%27"><span class="hs-identifier">modeUnEcb'</span></a></a><span> </span><a name="local-6989586621679067305"><a href="#local-6989586621679067305"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679067306"><a href="#local-6989586621679067306"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-566"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067307"><a href="#local-6989586621679067307"><span class="hs-identifier">chunks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a><span> </span><a href="#local-6989586621679067305"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067306"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-567"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-var">decryptBlock</span></a><span> </span><a href="#local-6989586621679067305"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067307"><span class="hs-identifier hs-var">chunks</span></a><span>
</span><a name="line-568"></a><span class="hs-pragma">{-# INLINE modeUnEcb' #-}</span><span>
</span><a name="line-569"></a><span>
</span><a name="line-570"></a><span class="hs-comment">-- |Cipher block chaining encryption mode on strict bytestrings</span><span>
</span><a name="line-571"></a><span class="hs-identifier">modeCbc'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066600"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066600"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066600"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066600"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-572"></a><a name="modeCbc%27"><a href="Crypto.Classes.html#modeCbc%27"><span class="hs-identifier">modeCbc'</span></a></a><span> </span><a name="local-6989586621679067308"><a href="#local-6989586621679067308"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067309"><a href="#local-6989586621679067309"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067310"><a href="#local-6989586621679067310"><span class="hs-identifier">plaintext</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-573"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067319"><a href="#local-6989586621679067319"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a><span> </span><a href="#local-6989586621679067308"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067310"><span class="hs-identifier hs-var">plaintext</span></a><span>
</span><a name="line-574"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067320"><a href="#local-6989586621679067320"><span class="hs-identifier">cts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067321"><a href="#local-6989586621679067321"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067311"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067319"><span class="hs-identifier hs-var">blks</span></a><span> </span><a href="#local-6989586621679067309"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-575"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679067320"><span class="hs-identifier hs-var">cts</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679067321"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-576"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-577"></a><span>  </span><a name="local-6989586621679067311"><a href="#local-6989586621679067311"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679067312"><a href="#local-6989586621679067312"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067312"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-578"></a><span>  </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067313"><a href="#local-6989586621679067313"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679067314"><a href="#local-6989586621679067314"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067315"><a href="#local-6989586621679067315"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-579"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067316"><a href="#local-6989586621679067316"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679067308"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><a href="#local-6989586621679067315"><span class="hs-identifier hs-var">iv</span></a><span> </span><a href="#local-6989586621679067313"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067317"><a href="#local-6989586621679067317"><span class="hs-identifier">cs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067318"><a href="#local-6989586621679067318"><span class="hs-identifier">ivFinal</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067311"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067314"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679067316"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-581"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067316"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679067317"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067318"><span class="hs-identifier hs-var">ivFinal</span></a><span class="hs-special">)</span><span>
</span><a name="line-582"></a><span class="hs-pragma">{-# INLINEABLE modeCbc' #-}</span><span>
</span><a name="line-583"></a><span>
</span><a name="line-584"></a><span class="hs-comment">-- |Cipher block chaining decryption for strict bytestrings</span><span>
</span><a name="line-585"></a><span class="hs-identifier">modeUnCbc'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066599"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066599"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066599"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066599"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-586"></a><a name="modeUnCbc%27"><a href="Crypto.Classes.html#modeUnCbc%27"><span class="hs-identifier">modeUnCbc'</span></a></a><span> </span><a name="local-6989586621679067322"><a href="#local-6989586621679067322"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067323"><a href="#local-6989586621679067323"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067324"><a href="#local-6989586621679067324"><span class="hs-identifier">ciphertext</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-587"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067333"><a href="#local-6989586621679067333"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a><span> </span><a href="#local-6989586621679067322"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067324"><span class="hs-identifier hs-var">ciphertext</span></a><span>
</span><a name="line-588"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067334"><a href="#local-6989586621679067334"><span class="hs-identifier">pts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067335"><a href="#local-6989586621679067335"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067325"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067333"><span class="hs-identifier hs-var">blks</span></a><span> </span><a href="#local-6989586621679067323"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-589"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679067334"><span class="hs-identifier hs-var">pts</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679067335"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-591"></a><span>  </span><a name="local-6989586621679067325"><a href="#local-6989586621679067325"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679067326"><a href="#local-6989586621679067326"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067326"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>  </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067327"><a href="#local-6989586621679067327"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679067328"><a href="#local-6989586621679067328"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067329"><a href="#local-6989586621679067329"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-593"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067330"><a href="#local-6989586621679067330"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#decryptBlock"><span class="hs-identifier hs-var">decryptBlock</span></a><span> </span><a href="#local-6989586621679067322"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067327"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067329"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-594"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067331"><a href="#local-6989586621679067331"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067332"><a href="#local-6989586621679067332"><span class="hs-identifier">ivFinal</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067325"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067328"><span class="hs-identifier hs-var">cs</span></a><span> </span><a href="#local-6989586621679067327"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-595"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067330"><span class="hs-identifier hs-var">p</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679067331"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067332"><span class="hs-identifier hs-var">ivFinal</span></a><span class="hs-special">)</span><span>
</span><a name="line-596"></a><span class="hs-pragma">{-# INLINEABLE modeUnCbc' #-}</span><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span class="hs-comment">-- |Output feedback mode for strict bytestrings</span><span>
</span><a name="line-599"></a><span class="hs-identifier">modeOfb'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066598"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066598"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066598"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066598"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-600"></a><a name="modeOfb%27"><a href="Crypto.Classes.html#modeOfb%27"><span class="hs-identifier">modeOfb'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnOfb%27"><span class="hs-identifier hs-var">modeUnOfb'</span></a><span>
</span><a name="line-601"></a><span class="hs-pragma">{-# INLINEABLE modeOfb' #-}</span><span>
</span><a name="line-602"></a><span>
</span><a name="line-603"></a><span class="hs-comment">-- |Output feedback mode for strict bytestrings</span><span>
</span><a name="line-604"></a><span class="hs-identifier">modeUnOfb'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066597"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066597"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066597"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066597"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-605"></a><a name="modeUnOfb%27"><a href="Crypto.Classes.html#modeUnOfb%27"><span class="hs-identifier">modeUnOfb'</span></a></a><span> </span><a name="local-6989586621679067336"><a href="#local-6989586621679067336"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067337"><a href="#local-6989586621679067337"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067338"><a href="#local-6989586621679067338"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-606"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067339"><a href="#local-6989586621679067339"><span class="hs-identifier">ivStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Util.html#collect"><span class="hs-identifier hs-var">collect</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679067338"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679067340"><span class="hs-identifier hs-var">ivLen</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">iterate</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679067336"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067337"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>            </span><a name="local-6989586621679067340"><a href="#local-6989586621679067340"><span class="hs-identifier">ivLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679067337"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-608"></a><span>            </span><a name="local-6989586621679067341"><a href="#local-6989586621679067341"><span class="hs-identifier">mLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679067338"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span>
</span><a name="line-609"></a><span>            </span><a name="local-6989586621679067342"><a href="#local-6989586621679067342"><span class="hs-identifier">newIV</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toChunks</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679067340"><span class="hs-identifier hs-var">ivLen</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621679067341"><span class="hs-identifier hs-var">mLen</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679067339"><span class="hs-identifier hs-var">ivStr</span></a><span>
</span><a name="line-610"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679067339"><span class="hs-identifier hs-var">ivStr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067338"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067342"><span class="hs-identifier hs-var">newIV</span></a><span class="hs-special">)</span><span>
</span><a name="line-611"></a><span class="hs-pragma">{-# INLINEABLE modeUnOfb' #-}</span><span>
</span><a name="line-612"></a><span>
</span><a name="line-613"></a><span class="hs-comment">-- |Counter mode for strict bytestrings</span><span>
</span><a name="line-614"></a><span class="hs-identifier">modeCtr'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066596"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066596"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066596"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066596"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066596"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066596"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-615"></a><a name="modeCtr%27"><a href="Crypto.Classes.html#modeCtr%27"><span class="hs-identifier">modeCtr'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#modeUnCtr%27"><span class="hs-identifier hs-var">modeUnCtr'</span></a><span>
</span><a name="line-616"></a><span class="hs-pragma">{-# INLINEABLE modeCtr' #-}</span><span>
</span><a name="line-617"></a><span>
</span><a name="line-618"></a><span class="hs-comment">-- |Counter mode for strict bytestrings</span><span>
</span><a name="line-619"></a><span class="hs-identifier">modeUnCtr'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066595"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066595"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066595"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679066595"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066595"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066595"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-620"></a><a name="modeUnCtr%27"><a href="Crypto.Classes.html#modeUnCtr%27"><span class="hs-identifier">modeUnCtr'</span></a></a><span> </span><a name="local-6989586621679067343"><a href="#local-6989586621679067343"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679067344"><a href="#local-6989586621679067344"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679067345"><a href="#local-6989586621679067345"><span class="hs-identifier">iv</span></a></a><span> </span><a name="local-6989586621679067346"><a href="#local-6989586621679067346"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-621"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067347"><a href="#local-6989586621679067347"><span class="hs-identifier">fa</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679067350"><a href="#local-6989586621679067350"><span class="hs-identifier">st</span></a></a><span class="hs-special">,</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067351"><a href="#local-6989586621679067351"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067352"><a href="#local-6989586621679067352"><span class="hs-identifier">c</span></a></a><span> </span><span>
</span><a name="line-622"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679067350"><span class="hs-identifier hs-var">st</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067347"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679067344"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067351"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067343"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679067351"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067352"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-623"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067353"><a href="#local-6989586621679067353"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679067354"><a href="#local-6989586621679067354"><span class="hs-identifier">nst</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">uncons</span><span> </span><a href="#local-6989586621679067350"><span class="hs-identifier hs-var">st</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679067354"><span class="hs-identifier hs-var">nst</span></a><span class="hs-special">,</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679067351"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-var">xor</span><span> </span><a href="#local-6989586621679067352"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679067353"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-624"></a><span>           </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679067348"><a href="#local-6989586621679067348"><span class="hs-identifier">newIV</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679067349"><a href="#local-6989586621679067349"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapAccumL</span><span> </span><a href="#local-6989586621679067347"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><a href="#local-6989586621679067345"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067346"><span class="hs-identifier hs-var">msg</span></a><span> </span><span>
</span><a name="line-625"></a><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067349"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><a href="#local-6989586621679067348"><span class="hs-identifier hs-var">newIV</span></a><span class="hs-special">)</span><span>
</span><a name="line-626"></a><span class="hs-pragma">{-# INLINEABLE modeUnCtr' #-}</span><span>
</span><a name="line-627"></a><span>
</span><a name="line-628"></a><span class="hs-comment">-- |Ciphertext feed-back encryption mode for strict bytestrings (with</span><span>
</span><a name="line-629"></a><span class="hs-comment">-- s == blockSize)</span><span>
</span><a name="line-630"></a><span class="hs-identifier">modeCfb'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066594"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066594"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066594"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066594"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-631"></a><a name="modeCfb%27"><a href="Crypto.Classes.html#modeCfb%27"><span class="hs-identifier">modeCfb'</span></a></a><span> </span><a name="local-6989586621679067355"><a href="#local-6989586621679067355"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067356"><a href="#local-6989586621679067356"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067357"><a href="#local-6989586621679067357"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-632"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067366"><a href="#local-6989586621679067366"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a><span> </span><a href="#local-6989586621679067355"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067357"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-633"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067367"><a href="#local-6989586621679067367"><span class="hs-identifier">cs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679067368"><a href="#local-6989586621679067368"><span class="hs-identifier">ivF</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067358"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067356"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679067366"><span class="hs-identifier hs-var">blks</span></a><span>
</span><a name="line-634"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679067367"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679067368"><span class="hs-identifier hs-var">ivF</span></a><span class="hs-special">)</span><span>
</span><a name="line-635"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-636"></a><span>  </span><a name="local-6989586621679067358"><a href="#local-6989586621679067358"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679067359"><a href="#local-6989586621679067359"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621679067359"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-637"></a><span>  </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679067360"><a href="#local-6989586621679067360"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679067361"><a href="#local-6989586621679067361"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679067362"><a href="#local-6989586621679067362"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-638"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067363"><a href="#local-6989586621679067363"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679067355"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067360"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067361"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-639"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067364"><a href="#local-6989586621679067364"><span class="hs-identifier">cs</span></a></a><span class="hs-special">,</span><a name="local-6989586621679067365"><a href="#local-6989586621679067365"><span class="hs-identifier">ivFinal</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067358"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067363"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679067362"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-640"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067363"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679067364"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067365"><span class="hs-identifier hs-var">ivFinal</span></a><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span class="hs-pragma">{-# INLINEABLE modeCfb' #-}</span><span>
</span><a name="line-642"></a><span>
</span><a name="line-643"></a><span class="hs-comment">-- |Ciphertext feed-back decryption mode for strict bytestrings (with s == blockSize)</span><span>
</span><a name="line-644"></a><span class="hs-identifier">modeUnCfb'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066593"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066593"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066593"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066593"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-645"></a><a name="modeUnCfb%27"><a href="Crypto.Classes.html#modeUnCfb%27"><span class="hs-identifier">modeUnCfb'</span></a></a><span> </span><a name="local-6989586621679067369"><a href="#local-6989586621679067369"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067370"><a href="#local-6989586621679067370"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679067371"><a href="#local-6989586621679067371"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-646"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067380"><a href="#local-6989586621679067380"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier hs-var">chunkFor'</span></a><span> </span><a href="#local-6989586621679067369"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067371"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-647"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067381"><a href="#local-6989586621679067381"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067382"><a href="#local-6989586621679067382"><span class="hs-identifier">ivF</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067372"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067370"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679067380"><span class="hs-identifier hs-var">blks</span></a><span>
</span><a name="line-648"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679067381"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a href="#local-6989586621679067382"><span class="hs-identifier hs-var">ivF</span></a><span class="hs-special">)</span><span>
</span><a name="line-649"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-650"></a><span>  </span><a name="local-6989586621679067372"><a href="#local-6989586621679067372"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679067373"><a href="#local-6989586621679067373"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067373"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>  </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679067374"><a href="#local-6989586621679067374"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679067375"><a href="#local-6989586621679067375"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679067376"><a href="#local-6989586621679067376"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-652"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067377"><a href="#local-6989586621679067377"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#encryptBlock"><span class="hs-identifier hs-var">encryptBlock</span></a><span> </span><a href="#local-6989586621679067369"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679067374"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067375"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-653"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679067378"><a href="#local-6989586621679067378"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067379"><a href="#local-6989586621679067379"><span class="hs-identifier">ivF</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067372"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067375"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679067376"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-654"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067377"><span class="hs-identifier hs-var">p</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679067378"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067379"><span class="hs-identifier hs-var">ivF</span></a><span class="hs-special">)</span><span>
</span><a name="line-655"></a><span class="hs-pragma">{-# INLINEABLE modeUnCfb' #-}</span><span>
</span><a name="line-656"></a><span>
</span><a name="line-657"></a><span class="hs-identifier">toChunks</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span>
</span><a name="line-658"></a><a name="toChunks"><a href="Crypto.Classes.html#toChunks"><span class="hs-identifier">toChunks</span></a></a><span> </span><a name="local-6989586621679067383"><a href="#local-6989586621679067383"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679067384"><a href="#local-6989586621679067384"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067385"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067384"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-659"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-660"></a><span>  </span><a name="local-6989586621679067385"><a href="#local-6989586621679067385"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679067386"><a href="#local-6989586621679067386"><span class="hs-identifier">b</span></a></a><span>
</span><a name="line-661"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679067386"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-662"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067387"><a href="#local-6989586621679067387"><span class="hs-identifier">h</span></a></a><span class="hs-special">,</span><a name="local-6989586621679067388"><a href="#local-6989586621679067388"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621679067383"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679067386"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-663"></a><span>                        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679067387"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679067385"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067388"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-664"></a><span>
</span><a name="line-665"></a><span class="hs-comment">-- |Increase an `IV` by one.  This is way faster than decoding,</span><span>
</span><a name="line-666"></a><span class="hs-comment">-- increasing, encoding</span><span>
</span><a name="line-667"></a><span class="hs-identifier">incIV</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066592"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066592"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066592"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-668"></a><a name="incIV"><a href="Crypto.Classes.html#incIV"><span class="hs-identifier">incIV</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067389"><a href="#local-6989586621679067389"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapAccumR</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067390"><span class="hs-identifier hs-var">incw</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679067389"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-669"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-670"></a><span>       </span><span class="hs-identifier">incw</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-671"></a><span>       </span><a name="local-6989586621679067390"><a href="#local-6989586621679067390"><span class="hs-identifier">incw</span></a></a><span> </span><a name="local-6989586621679067391"><a href="#local-6989586621679067391"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679067392"><a href="#local-6989586621679067392"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067393"><a href="#local-6989586621679067393"><span class="hs-identifier">nw</span></a></a><span class="hs-glyph">=</span><a href="#local-6989586621679067391"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679067392"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">shiftR</span><span> </span><a href="#local-6989586621679067393"><span class="hs-identifier hs-var">nw</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679067393"><span class="hs-identifier hs-var">nw</span></a><span class="hs-special">)</span><span>
</span><a name="line-672"></a><span>
</span><a name="line-673"></a><span class="hs-comment">-- |Obtain an `IV` made only of zeroes</span><span>
</span><a name="line-674"></a><span class="hs-identifier">zeroIV</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066591"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066591"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-675"></a><a name="zeroIV"><a href="Crypto.Classes.html#zeroIV"><span class="hs-identifier">zeroIV</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067395"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-676"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679067394"><a href="#local-6989586621679067394"><span class="hs-identifier">bytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier hs-var">ivBlockSizeBytes</span></a><span> </span><a href="#local-6989586621679067395"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-677"></a><span>        </span><a name="local-6989586621679067395"><a href="#local-6989586621679067395"><span class="hs-identifier">iv</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">replicate</span><span>  </span><a href="#local-6989586621679067394"><span class="hs-identifier hs-var">bytes</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-678"></a><span>
</span><a name="line-679"></a><span class="hs-identifier">zeroIVcwc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066590"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066590"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-680"></a><a name="zeroIVcwc"><a href="Crypto.Classes.html#zeroIVcwc"><span class="hs-identifier">zeroIVcwc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067397"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-681"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679067396"><a href="#local-6989586621679067396"><span class="hs-identifier">bytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier hs-var">ivBlockSizeBytes</span></a><span> </span><a href="#local-6989586621679067397"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">5</span><span>  </span><span class="hs-comment">-- a constant of cwc (4 bytes for ctr mode, 1 for a sort of header on the iv)</span><span>
</span><a name="line-682"></a><span>        </span><a name="local-6989586621679067397"><a href="#local-6989586621679067397"><span class="hs-identifier">iv</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679067396"><span class="hs-identifier hs-var">bytes</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span class="hs-comment">-- Break a bytestring into block size chunks.</span><span>
</span><a name="line-685"></a><span class="hs-identifier">chunkFor</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066589"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066589"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span>
</span><a name="line-686"></a><a name="chunkFor"><a href="Crypto.Classes.html#chunkFor"><span class="hs-identifier">chunkFor</span></a></a><span> </span><a name="local-6989586621679067398"><a href="#local-6989586621679067398"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067401"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-687"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-688"></a><span>  </span><a name="local-6989586621679067399"><a href="#local-6989586621679067399"><span class="hs-identifier">blkSz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679067398"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-689"></a><span>  </span><a name="local-6989586621679067400"><a href="#local-6989586621679067400"><span class="hs-identifier">blkSzI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679067399"><span class="hs-identifier hs-var">blkSz</span></a><span>
</span><a name="line-690"></a><span>  </span><a name="local-6989586621679067401"><a href="#local-6989586621679067401"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679067402"><a href="#local-6989586621679067402"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679067402"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679067400"><span class="hs-identifier hs-var">blkSzI</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-691"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067403"><a href="#local-6989586621679067403"><span class="hs-identifier">blk</span></a></a><span class="hs-special">,</span><a name="local-6989586621679067404"><a href="#local-6989586621679067404"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621679067400"><span class="hs-identifier hs-var">blkSzI</span></a><span> </span><a href="#local-6989586621679067402"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toChunks</span><span> </span><a href="#local-6989586621679067403"><span class="hs-identifier hs-var">blk</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679067401"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067404"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-692"></a><span class="hs-pragma">{-# INLINE chunkFor #-}</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-comment">-- Break a bytestring into block size chunks.</span><span>
</span><a name="line-695"></a><span class="hs-identifier">chunkFor'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066588"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679066588"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span>
</span><a name="line-696"></a><a name="chunkFor%27"><a href="Crypto.Classes.html#chunkFor%27"><span class="hs-identifier">chunkFor'</span></a></a><span> </span><a name="local-6989586621679067405"><a href="#local-6989586621679067405"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679067407"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-697"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-698"></a><span>  </span><a name="local-6989586621679067406"><a href="#local-6989586621679067406"><span class="hs-identifier">blkSz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679067405"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-699"></a><span>  </span><a name="local-6989586621679067407"><a href="#local-6989586621679067407"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679067408"><a href="#local-6989586621679067408"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679067408"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679067406"><span class="hs-identifier hs-var">blkSz</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-700"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067409"><a href="#local-6989586621679067409"><span class="hs-identifier">blk</span></a></a><span class="hs-special">,</span><a name="local-6989586621679067410"><a href="#local-6989586621679067410"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621679067406"><span class="hs-identifier hs-var">blkSz</span></a><span> </span><a href="#local-6989586621679067408"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679067409"><span class="hs-identifier hs-var">blk</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679067407"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679067410"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-701"></a><span class="hs-pragma">{-# INLINE chunkFor' #-}</span><span>
</span><a name="line-702"></a><span>
</span><a name="line-703"></a><span class="hs-comment">-- |Create the mask for SIV based ciphers</span><span>
</span><a name="line-704"></a><span class="hs-identifier">sivMask</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-705"></a><a name="sivMask"><a href="Crypto.Classes.html#sivMask"><span class="hs-identifier">sivMask</span></a></a><span> </span><a name="local-6989586621679067411"><a href="#local-6989586621679067411"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapAccumR</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067412"><span class="hs-identifier hs-var">go</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679067411"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-706"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-707"></a><span>       </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span>       </span><a name="local-6989586621679067412"><a href="#local-6989586621679067412"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-number">24</span><span> </span><a name="local-6989586621679067413"><a href="#local-6989586621679067413"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">32</span><span class="hs-special">,</span><span class="hs-identifier hs-var">clearBit</span><span> </span><a href="#local-6989586621679067413"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span>
</span><a name="line-709"></a><span>       </span><span class="hs-identifier">go</span><span> </span><span class="hs-number">56</span><span> </span><a name="local-6989586621679067414"><a href="#local-6989586621679067414"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">64</span><span class="hs-special">,</span><span class="hs-identifier hs-var">clearBit</span><span> </span><a href="#local-6989586621679067414"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span>       </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679067415"><a href="#local-6989586621679067415"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679067416"><a href="#local-6989586621679067416"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067415"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">8</span><span class="hs-special">,</span><a href="#local-6989586621679067416"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-711"></a><span>
</span><a name="line-712"></a><span class="hs-identifier">ivBlockSizeBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679066587"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679066587"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-713"></a><a name="ivBlockSizeBytes"><a href="Crypto.Classes.html#ivBlockSizeBytes"><span class="hs-identifier">ivBlockSizeBytes</span></a></a><span> </span><a name="local-6989586621679067417"><a href="#local-6989586621679067417"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-714"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067420"><a href="#local-6989586621679067420"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Classes.html#deIVProxy"><span class="hs-identifier hs-var">deIVProxy</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067418"><span class="hs-identifier hs-var">proxyOf</span></a><span> </span><a href="#local-6989586621679067417"><span class="hs-identifier hs-var">iv</span></a><span class="hs-special">)</span><span>
</span><a name="line-715"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">proxy</span><span> </span><a href="Crypto.Classes.html#blockSize"><span class="hs-identifier hs-var">blockSize</span></a><span> </span><a href="#local-6989586621679067420"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-716"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-717"></a><span>  </span><span class="hs-identifier">proxyOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679067419"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679067419"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-718"></a><span>  </span><a name="local-6989586621679067418"><a href="#local-6989586621679067418"><span class="hs-identifier">proxyOf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-719"></a><span class="hs-pragma">{-# INLINEABLE ivBlockSizeBytes #-}</span><span>
</span><a name="line-720"></a><span>
</span><a name="line-721"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679067421"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679067421"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-722"></a><span>        </span><a name="local-8214565720323791789"><span class="hs-identifier">get</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-723"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067422"><a href="#local-6989586621679067422"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-724"></a><span>                    </span><span class="hs-identifier">doGet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Classes.html#BlockCipher"><span class="hs-identifier hs-type">BlockCipher</span></a><span> </span><a href="#local-6989586621679067424"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679067424"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-type">IV</span></a><span> </span><a href="#local-6989586621679067424"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-725"></a><span>                    </span><a name="local-6989586621679067423"><a href="#local-6989586621679067423"><span class="hs-identifier">doGet</span></a></a><span> </span><a name="local-6989586621679067425"><a href="#local-6989586621679067425"><span class="hs-identifier">pr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SG</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getByteString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">proxy</span><span> </span><a href="Crypto.Classes.html#blockSizeBytes"><span class="hs-identifier hs-var">blockSizeBytes</span></a><span> </span><a href="#local-6989586621679067425"><span class="hs-identifier hs-var">pr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-726"></a><span>                </span><a name="local-6989586621679067426"><a href="#local-6989586621679067426"><span class="hs-identifier">iv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679067423"><span class="hs-identifier hs-var">doGet</span></a><span> </span><a href="#local-6989586621679067422"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-727"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067426"><span class="hs-identifier hs-var">iv</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asProxyTypeOf</span><span class="hs-special">`</span><span> </span><a href="Crypto.Classes.html#ivProxy"><span class="hs-identifier hs-var">ivProxy</span></a><span> </span><a href="#local-6989586621679067422"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>        </span><a name="local-8214565720323791790"><span class="hs-identifier">put</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Types.html#IV"><span class="hs-identifier hs-var">IV</span></a><span> </span><a name="local-6989586621679067427"><a href="#local-6989586621679067427"><span class="hs-identifier">iv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SP</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">putByteString</span><span> </span><a href="#local-6989586621679067427"><span class="hs-identifier hs-var">iv</span></a><span>
</span><a name="line-729"></a><span>
</span><a name="line-730"></a></pre></body></html>